{
  "version": 3,
  "sources": ["../src/config.js", "../src/app.js"],
  "sourcesContent": ["/**\n * Spark Voice - Configuration\n */\n\nexport const CONFIG = {\n  wsUrl: (() => {\n    const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const base = `${protocol}//${location.host}`;\n    const path = location.pathname.replace(/\\/+$/, '');\n    return path && path !== '/' ? `${base}${path}` : base;\n  })(),\n  silenceMs: 1500,\n};\n\nexport const MODE_DEFAULTS = {\n  dev: { name: 'Dev Mode', icon: '\uD83D\uDC68\u200D\uD83D\uDCBB', notifyWhatsApp: true },\n  research: { name: 'Research Mode', icon: '\uD83D\uDD2C', notifyWhatsApp: true },\n  plan: { name: 'Plan Mode', icon: '\uD83D\uDCCB', notifyWhatsApp: true },\n  articulate: { name: 'Articulate Mode', icon: '\u270D\uFE0F', notifyWhatsApp: false },\n  dailyreports: { name: 'Daily Reports', icon: '\uD83D\uDCCA', notifyWhatsApp: true },\n  videogen: { name: 'Video Gen', icon: '\uD83C\uDFAC', notifyWhatsApp: true }\n};\n", "/**\n * Spark Voice v2.0 - Modular Refactor (Step 1: CONFIG extracted)\n */\n\nimport { CONFIG, MODE_DEFAULTS } from './config.js';\n\nconsole.log('\u26A1 Spark Voice v2.0 (Step 1: CONFIG extracted)');\n\n// Elements\nconst messagesEl = document.getElementById('messages');\nconst welcomeEl = document.getElementById('welcome');\nconst textInput = document.getElementById('text-input');\nconst sendBtn = document.getElementById('send-btn');\nconst voiceBtn = document.getElementById('voice-btn');\nconst notesBtn = document.getElementById('notes-btn');\nconst statusEl = document.getElementById('status');\nconst timerEl = document.getElementById('timer');\nconst toastEl = document.getElementById('toast');\nconst uploadBtn = document.getElementById('upload-btn');\nconst fileInput = document.getElementById('file-input');\nconst bottomEl = document.getElementById('bottom');\nconst sparkStatusEl = document.getElementById('spark-status');\nlet activeSessionsData = { count: 0, thinking: false, sessions: [] };\n\n// Update Spark gateway connection status pill\nfunction updateSparkStatus(state) {\n  if (!sparkStatusEl) return;\n  sparkStatusEl.classList.remove('connected', 'connecting');\n  if (state === 'connected') {\n    sparkStatusEl.classList.add('connected');\n    sparkStatusEl.title = 'Clawdbot Gateway: Connected';\n    // Fetch sessions on connect\n    fetchActiveSessions();\n  } else if (state === 'connecting') {\n    sparkStatusEl.classList.add('connecting');\n    sparkStatusEl.title = 'Clawdbot Gateway: Connecting...';\n  } else {\n    // disconnected - no class, shows red\n    sparkStatusEl.title = 'Clawdbot Gateway: Disconnected';\n  }\n}\n\n// Fetch active sessions from gateway\nasync function fetchActiveSessions() {\n  try {\n    const res = await fetch('/api/active-sessions');\n    const data = await res.json();\n    activeSessionsData = data;\n    updateSparkPillText();\n  } catch (e) {\n    console.error('Failed to fetch active sessions:', e);\n  }\n}\n\n// Update pill to show session status\nfunction updateSparkPillText() {\n  if (!sparkStatusEl) return;\n  \n  // Find or create count badge\n  let countBadge = sparkStatusEl.querySelector('.session-count');\n  if (!countBadge) {\n    countBadge = document.createElement('span');\n    countBadge.className = 'session-count';\n    sparkStatusEl.appendChild(countBadge);\n  }\n  \n  // Count sub-agents (sessions that aren't main)\n  const subAgentCount = (activeSessionsData.sessions || []).filter(s => s.isSubagent).length;\n  \n  // Green outline ONLY when processing OR sub-agents running\n  if (isProcessing || subAgentCount > 0) {\n    sparkStatusEl.classList.add('active');\n  } else {\n    sparkStatusEl.classList.remove('active');\n  }\n  \n  // Show count only when sub-agents are running\n  if (subAgentCount > 0) {\n    countBadge.textContent = subAgentCount;\n    countBadge.style.display = 'flex';\n  } else {\n    countBadge.style.display = 'none';\n  }\n}\n\n// Toggle sessions popup on click\nsparkStatusEl?.addEventListener('click', (e) => {\n  e.stopPropagation(); // Prevent immediate re-close from document click listener\n  const existing = document.getElementById('sessions-popup');\n  if (existing) {\n    // Popup is open, close it\n    existing.remove();\n  } else {\n    // Popup is closed, open it\n    showSessionsPopup();\n    // Refresh in background\n    fetchActiveSessions().then(() => {\n      const popup = document.getElementById('sessions-popup');\n      if (popup) updateSessionsPopupContent(popup);\n    });\n  }\n});\n\nfunction getSessionDescription(s) {\n  // Extract task type from label\n  const label = (s.label || '').toLowerCase();\n  if (label.includes('engineer')) return 'Implementing fixes...';\n  if (label.includes('qa')) return 'Reviewing code...';\n  if (label.includes('dev')) return 'Running dev workflow...';\n  if (label.includes('test')) return 'Running test...';\n  return 'Working...';\n}\n\nfunction getSessionIcon(s) {\n  // SVG icons instead of emojis\n  if (s.isMain) {\n    return `<svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M13 3L4 14h7v7l9-11h-7V3z\"/></svg>`;\n  }\n  if (s.isSubagent) {\n    return `<svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z\"/></svg>`;\n  }\n  return `<svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><circle cx=\"12\" cy=\"12\" r=\"8\"/></svg>`;\n}\n\nfunction updateSessionsPopupContent(popup) {\n  const sessions = activeSessionsData.sessions || [];\n  // Only show sub-agents (background tasks), not main session\n  const subAgents = sessions.filter(s => s.isSubagent);\n  \n  if (subAgents.length === 0) {\n    popup.innerHTML = `\n      <div style=\"color: var(--text-secondary); font-size: 14px;\">\n        No background tasks running\n      </div>\n    `;\n  } else {\n    popup.innerHTML = `\n      <div style=\"font-weight: 600; margin-bottom: 12px; font-size: 14px; color: var(--text);\">\n        Background Tasks (${subAgents.length})\n      </div>\n      ${subAgents.map(s => `\n        <div style=\"padding: 10px; background: var(--input-bg); \n          border-radius: 8px; margin-bottom: 8px; display: flex; align-items: flex-start; gap: 10px;\">\n          <div style=\"opacity: 0.6; margin-top: 2px;\">${getSessionIcon(s)}</div>\n          <div style=\"flex: 1; min-width: 0;\">\n            <div style=\"font-weight: 500; font-size: 13px; color: var(--text);\">\n              ${s.label || 'Task'}\n            </div>\n            <div style=\"font-size: 12px; color: var(--text-secondary); margin-top: 2px;\">\n              ${getSessionDescription(s)}\n            </div>\n          </div>\n        </div>\n      `).join('')}\n    `;\n  }\n}\n\nfunction showSessionsPopup() {\n  // Remove existing popup\n  document.getElementById('sessions-popup')?.remove();\n  \n  const popup = document.createElement('div');\n  popup.id = 'sessions-popup';\n  popup.style.cssText = `\n    position: fixed; top: 70px; left: 16px;\n    background: var(--bg); border-radius: 12px;\n    padding: 16px; min-width: 260px; max-width: 320px;\n    box-shadow: 0 10px 40px rgba(0,0,0,0.3);\n    border: 1px solid var(--input-border);\n    z-index: 1000;\n  `;\n  \n  updateSessionsPopupContent(popup);\n  document.body.appendChild(popup);\n  \n  // Close on click outside\n  const closePopup = (e) => {\n    if (!popup.contains(e.target) && !sparkStatusEl.contains(e.target)) {\n      popup.remove();\n      document.removeEventListener('click', closePopup);\n    }\n  };\n  setTimeout(() => document.addEventListener('click', closePopup), 10);\n}\nconst voiceBar = document.getElementById('voice-bar');\nconst closeVoiceBtn = document.getElementById('close-voice-btn');\nconst waveformEl = document.getElementById('waveform');\nconst voiceContent = document.getElementById('voice-content');\nconst voiceStatus = document.getElementById('voice-status');\nconst notesContent = document.getElementById('notes-content');\nconst notesTimerEl = document.getElementById('notes-timer');\nconst notesBar = document.getElementById('notes-bar');\nconst closeNotesBtn = document.getElementById('close-notes-btn');\nconst deleteNotesBtn = document.getElementById('delete-notes-btn');\nconst closeBtn = document.getElementById('close-btn');\nconst historyBtn = document.getElementById('history-btn');\nconst themeBtn = document.getElementById('theme-btn');\n\n// Theme toggle\nfunction initTheme() {\n  const saved = localStorage.getItem('theme');\n  if (saved) {\n    document.documentElement.setAttribute('data-theme', saved);\n  }\n}\ninitTheme();\n\nthemeBtn?.addEventListener('click', () => {\n  const current = document.documentElement.getAttribute('data-theme');\n  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n  \n  let newTheme;\n  if (current === 'dark') {\n    newTheme = 'light';\n  } else if (current === 'light') {\n    newTheme = 'dark';\n  } else {\n    // No explicit theme set, toggle from system preference\n    newTheme = prefersDark ? 'light' : 'dark';\n  }\n  \n  document.documentElement.setAttribute('data-theme', newTheme);\n  localStorage.setItem('theme', newTheme);\n});\n\n// Model toggle (Claude <-> Kimi)\nconst modelBtn = document.getElementById('model-btn');\nlet currentModel = localStorage.getItem('ai-model') || 'claude';\n\nfunction updateModelButton() {\n  const label = modelBtn?.querySelector('.model-label');\n  if (label) {\n    label.textContent = currentModel === 'kimi' ? 'Kimi' : 'Claude';\n  }\n  modelBtn?.classList.toggle('kimi', currentModel === 'kimi');\n}\nupdateModelButton();\n\nmodelBtn?.addEventListener('click', () => {\n  currentModel = currentModel === 'claude' ? 'kimi' : 'claude';\n  localStorage.setItem('ai-model', currentModel);\n  updateModelButton();\n  showToast(`Switched to ${currentModel === 'kimi' ? 'Kimi K2.5' : 'Claude'}`);\n});\n\n// State\nlet ws = null;\nlet mode = 'chat';\nlet pageState = 'intro'; // 'intro' or 'chatfeed'\nlet articulationsMode = false; // Text refinement mode\n// Realtime voice state is defined in the REALTIME VOICE MODE section\nlet isListening = false;\nlet realtimeReconnectAttempts = 0;\nconst MAX_RECONNECT_ATTEMPTS = 5;\nlet isProcessing = false;\nlet audioContext = null;\nlet currentAudio = null;\nlet mediaRecorder = null;\nlet audioChunks = [];\nlet recordStart = null;\nlet timerInterval = null;\nlet mediaStream = null;\n\n// ============================================================================\n// MODE SESSION STATE - Separate sessions for each mode\n// ============================================================================\nlet currentSparkMode = null; // null = main session, or 'dev', 'research', 'plan', 'articulate', 'dailyreports', 'videogen'\nlet modeHistory = {}; // Cache history per mode\nlet modeConfigs = {}; // Loaded from server\n\n// Mode configuration (will be loaded from server, fallback here)\n\n// Load mode configs from server\nasync function loadModeConfigs() {\n  try {\n    const res = await fetch('/api/modes');\n    const data = await res.json();\n    modeConfigs = data.modes || {};\n    console.log('\uD83D\uDCE6 Loaded mode configs:', Object.keys(modeConfigs));\n  } catch (e) {\n    console.error('Failed to load mode configs:', e);\n    modeConfigs = MODE_DEFAULTS;\n  }\n}\n\n// Get config for a mode\nfunction getModeConfig(mode) {\n  return modeConfigs[mode] || MODE_DEFAULTS[mode] || { name: mode, icon: '\uD83D\uDCE6' };\n}\n\n// Enter a mode (show mode-specific chat view)\nasync function enterMode(modeName) {\n  const config = getModeConfig(modeName);\n  console.log(`\uD83D\uDCE6 Entering ${config.name}...`);\n  \n  currentSparkMode = modeName;\n  \n  // Show chat feed page with mode indicator\n  showChatFeedPage();\n  \n  // Update UI to show mode\n  updateModeIndicator();\n  \n  // Load mode history\n  await loadModeHistory(modeName);\n  \n  // Clear current messages and show mode history\n  renderModeHistory(modeName);\n}\n\n// Exit mode (return to main session)\nfunction exitMode() {\n  console.log('\uD83D\uDCE6 Exiting mode, returning to main...');\n  \n  currentSparkMode = null;\n  updateModeIndicator();\n  \n  // Reload main chat history\n  historyRendered = false;\n  if (pageState === 'chatfeed') {\n    renderChatHistory();\n  }\n}\n\n// Update mode indicator in UI\nfunction updateModeIndicator() {\n  let indicator = document.getElementById('mode-indicator');\n  \n  if (currentSparkMode) {\n    const config = getModeConfig(currentSparkMode);\n    \n    if (!indicator) {\n      // Create indicator\n      indicator = document.createElement('div');\n      indicator.id = 'mode-indicator';\n      indicator.className = 'mode-indicator';\n      document.querySelector('.top-bar')?.appendChild(indicator);\n    }\n    \n    indicator.innerHTML = `\n      <span class=\"mode-icon\">${config.icon}</span>\n      <span class=\"mode-name\">${config.name}</span>\n      <button class=\"mode-exit-btn\" onclick=\"exitMode()\">\u2715</button>\n    `;\n    indicator.style.display = 'flex';\n  } else {\n    if (indicator) {\n      indicator.style.display = 'none';\n    }\n  }\n}\n\n// Load history from mode session\nasync function loadModeHistory(modeName) {\n  try {\n    // Request via WebSocket if connected\n    if (ws && ws.readyState === WebSocket.OPEN) {\n      ws.send(JSON.stringify({ type: 'mode_history', sparkMode: modeName }));\n    } else {\n      // Fallback to REST\n      const res = await fetch(`/api/modes/${modeName}/history`);\n      const data = await res.json();\n      modeHistory[modeName] = data.messages || [];\n    }\n  } catch (e) {\n    console.error(`Failed to load ${modeName} history:`, e);\n    modeHistory[modeName] = [];\n  }\n}\n\n// Render mode history in chat feed\nfunction renderModeHistory(modeName) {\n  const messages = modeHistory[modeName] || [];\n  // Clear messages but preserve the welcome element\n  messagesEl.querySelectorAll('.msg, .mode-empty-state').forEach(el => el.remove());\n  \n  if (messages.length === 0) {\n    const config = getModeConfig(modeName);\n    // Show empty state\n    const emptyEl = document.createElement('div');\n    emptyEl.className = 'mode-empty-state';\n    emptyEl.innerHTML = `\n      <div class=\"mode-empty-icon\">${config.icon}</div>\n      <div class=\"mode-empty-title\">${config.name}</div>\n      <div class=\"mode-empty-desc\">Start a conversation in this mode.</div>\n    `;\n    messagesEl.appendChild(emptyEl);\n  } else {\n    // Render messages\n    for (const msg of messages) {\n      const text = extractMessageText(msg);\n      if (text) {\n        addMessage(msg.role === 'assistant' ? 'bot' : 'user', text);\n      }\n    }\n  }\n  \n  scrollToBottom();\n}\n\n// Extract text from message content (handles various formats)\nfunction extractMessageText(msg) {\n  if (!msg?.content) return null;\n  if (typeof msg.content === 'string') return msg.content;\n  if (Array.isArray(msg.content)) {\n    const textPart = msg.content.find(c => c.type === 'text');\n    return textPart?.text || null;\n  }\n  return null;\n}\n\n// Initialize mode system\nloadModeConfigs();\n\n// Pre-loaded chat history (loaded in background on page init)\nlet preloadedHistory = null;\nlet historyLoadPromise = null;\nlet historyRendered = false; // Prevent double-rendering\n\n// ============================================================================\n// PAGE STATE MANAGEMENT\n// ============================================================================\n\n// Background load chat history on page init (no loading screen)\nfunction loadHistoryInBackground(forceRefresh = false) {\n  if (historyLoadPromise && !forceRefresh) return historyLoadPromise;\n  \n  historyLoadPromise = fetch('/api/messages/all')\n    .then(res => res.json())\n    .then(data => {\n      preloadedHistory = data.messages || [];\n      console.log(`\uD83D\uDCDC Pre-loaded ${preloadedHistory.length} messages`);\n      \n      // Track latest timestamp for catch-up on reconnect\n      if (preloadedHistory.length > 0) {\n        const lastMsg = preloadedHistory[preloadedHistory.length - 1];\n        if (lastMsg.timestamp && lastMsg.timestamp > lastMessageTimestamp) {\n          lastMessageTimestamp = lastMsg.timestamp;\n          console.log(`\uD83D\uDCDC Set lastMessageTimestamp to ${lastMessageTimestamp}`);\n        }\n      }\n      \n      return preloadedHistory;\n    })\n    .catch(e => {\n      console.error('Failed to preload history:', e);\n      preloadedHistory = [];\n      return [];\n    });\n  \n  return historyLoadPromise;\n}\n\n// Refresh preloaded history in background (called after new messages arrive)\nfunction refreshHistoryCache() {\n  historyLoadPromise = null;\n  historyRendered = false;\n  loadHistoryInBackground(true);\n}\n\n// Render pre-loaded history into messages container\nfunction renderPreloadedHistory() {\n  // Prevent double-rendering\n  if (historyRendered) return;\n  if (!preloadedHistory || preloadedHistory.length === 0) return;\n  \n  historyRendered = true;\n  \n  preloadedHistory.forEach(m => {\n    const el = document.createElement('div');\n    el.className = `msg ${m.role === 'user' ? 'user' : 'bot'}`;\n    if (m.role === 'user') {\n      el.textContent = m.text;\n    } else {\n      el.innerHTML = formatMessage(m.text);\n    }\n    messagesEl.appendChild(el);\n  });\n  \n  // Scroll to bottom\n  messagesEl.scrollTop = messagesEl.scrollHeight;\n}\n\n// Transition lock to prevent race conditions between page state changes\nlet isTransitioning = false;\n\nfunction showIntroPage() {\n  // Prevent race conditions during transitions\n  if (isTransitioning) {\n    console.log('showIntroPage blocked - transition in progress');\n    return;\n  }\n  isTransitioning = true;\n  \n  console.log('showIntroPage called');\n  \n  requestAnimationFrame(() => {\n    pageState = 'intro';\n    \n    // Clear any active mode session\n    currentSparkMode = null;\n    updateModeIndicator();\n    \n    // Reset articulations mode (previously monkey-patched)\n    articulationsMode = false;\n    if (textInput) textInput.placeholder = 'Talk to me';\n    \n    // Remove chatfeed mode from body\n    document.body.classList.remove('chatfeed-mode');\n    // Show welcome\n    if (welcomeEl) welcomeEl.style.display = '';\n    // Clear messages (but keep welcome) - includes thinking indicators\n    messagesEl?.querySelectorAll('.msg').forEach(m => m.remove());\n    // Remove any thinking indicator that might be lingering\n    removeThinking();\n    // Reset history rendered flag so it can be re-rendered next time\n    historyRendered = false;\n    // Show history button (class-based only)\n    if (historyBtn) {\n      historyBtn.classList.remove('hidden');\n    }\n    // Close button removed - overscroll gesture handles return to intro\n    // Reset scroll position and set overflow for browsers without :has() support\n    if (messagesEl) {\n      messagesEl.scrollTop = 0;\n      messagesEl.style.overflow = 'hidden';\n    }\n    \n    isTransitioning = false;\n  });\n}\n\nfunction showChatFeedPage(options = {}) {\n  // Prevent race conditions during transitions\n  if (isTransitioning) {\n    console.log('showChatFeedPage blocked - transition in progress');\n    return;\n  }\n  isTransitioning = true;\n  \n  console.log('showChatFeedPage called');\n  \n  requestAnimationFrame(() => {\n    pageState = 'chatfeed';\n    // Add chatfeed mode to body (hides header buttons)\n    document.body.classList.add('chatfeed-mode');\n    // Hide welcome\n    if (welcomeEl) welcomeEl.style.display = 'none';\n    // Hide history button (class-based only)\n    if (historyBtn) {\n      historyBtn.classList.add('hidden');\n    }\n    // Close button removed - overscroll gesture handles return to intro\n    // Enable scrolling for browsers without :has() support\n    if (messagesEl) {\n      messagesEl.style.overflow = 'auto';\n    }\n    \n    // Render pre-loaded history instantly (unless skipped)\n    if (!options.skipHistory && preloadedHistory && preloadedHistory.length > 0) {\n      renderPreloadedHistory();\n    }\n    \n    isTransitioning = false;\n  });\n}\n\n// History button - show chat feed with pre-loaded history (instant, no loading)\nhistoryBtn?.addEventListener('click', async () => {\n  // If history not yet loaded, wait for it briefly\n  if (preloadedHistory === null && historyLoadPromise) {\n    await historyLoadPromise;\n  }\n  \n  // showChatFeedPage will render pre-loaded history automatically\n  showChatFeedPage();\n  \n  // If still empty after load, show message\n  if (!preloadedHistory || preloadedHistory.length === 0) {\n    const emptyEl = document.createElement('div');\n    emptyEl.className = 'msg system';\n    emptyEl.textContent = 'No chat history yet';\n    messagesEl.appendChild(emptyEl);\n  }\n});\n\n// Close button - go back to intro (legacy, button now hidden)\ncloseBtn?.addEventListener('click', (e) => {\n  e.preventDefault();\n  e.stopPropagation();\n  console.log('Close button clicked');\n  showIntroPage();\n});\n\n// ============================================================================\n// CLOSE CHAT BUTTON (shown in chatfeed mode)\n// ============================================================================\nconst closeChatBtn = document.getElementById('close-chat-btn');\n\ncloseChatBtn?.addEventListener('click', (e) => {\n  e.preventDefault();\n  e.stopPropagation();\n  // Add slide-out animation\n  document.body.classList.add('slide-out');\n  setTimeout(() => {\n    document.body.classList.remove('slide-out');\n    showIntroPage();\n  }, 250);\n});\n\n// ============================================================================\n// PULL DOWN TO OPEN CHAT (on intro page)\n// ============================================================================\nconst SCROLL_THRESHOLD = 50; // pixels to pull down to trigger\nlet introTouchStartY = 0;\nlet introScrollTriggered = false;\n\n// Touch detection on messages area (which contains welcome on intro)\nmessagesEl?.addEventListener('touchstart', (e) => {\n  if (pageState !== 'intro') return;\n  introTouchStartY = e.touches[0].clientY;\n  introScrollTriggered = false;\n}, { passive: true });\n\nmessagesEl?.addEventListener('touchmove', (e) => {\n  if (pageState !== 'intro' || introScrollTriggered) return;\n  \n  const currentY = e.touches[0].clientY;\n  const pullDistance = currentY - introTouchStartY; // positive = finger moved down (pull down gesture)\n  \n  if (pullDistance >= SCROLL_THRESHOLD) {\n    introScrollTriggered = true;\n    openChatWithLoading();\n  }\n}, { passive: true });\n\n// Mouse wheel on intro\nmessagesEl?.addEventListener('wheel', (e) => {\n  if (pageState !== 'intro') return;\n  \n  // deltaY < 0 means scrolling up (pull down equivalent)\n  if (e.deltaY < -SCROLL_THRESHOLD) {\n    openChatWithLoading();\n  }\n}, { passive: true });\n\n// Open chat with loading state\nasync function openChatWithLoading() {\n  // Show loading indicator\n  showThinking();\n  \n  // Try to load history with timeout\n  try {\n    if (preloadedHistory === null && historyLoadPromise) {\n      // Wait for existing load, but timeout after 3s\n      await Promise.race([\n        historyLoadPromise,\n        new Promise((_, reject) => setTimeout(() => reject('timeout'), 3000))\n      ]);\n    } else if (preloadedHistory === null) {\n      // Force a fresh load with timeout\n      await Promise.race([\n        loadHistoryInBackground(true),\n        new Promise((_, reject) => setTimeout(() => reject('timeout'), 3000))\n      ]);\n    }\n  } catch (e) {\n    console.log('History load timeout or error:', e);\n  }\n  \n  removeThinking();\n  \n  // Add slide-in animation\n  document.body.classList.add('slide-in');\n  showChatFeedPage();\n  setTimeout(() => document.body.classList.remove('slide-in'), 400);\n  \n  // Show message if no history\n  if (!preloadedHistory || preloadedHistory.length === 0) {\n    const emptyEl = document.createElement('div');\n    emptyEl.className = 'msg system';\n    emptyEl.textContent = 'No chat history yet';\n    messagesEl.appendChild(emptyEl);\n  }\n}\n\n// ============================================================================\n// MESSAGES\n// ============================================================================\n\n// Track recently displayed messages to prevent duplicates (by content hash)\nconst displayedMessageHashes = new Set();\nconst MAX_DISPLAYED_HASHES = 50;\n\nfunction hashMessageContent(text) {\n  // Simple hash for deduplication\n  const str = (text || '').trim().slice(0, 200);\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    hash = ((hash << 5) - hash) + str.charCodeAt(i);\n    hash = hash & hash;\n  }\n  return hash.toString(36);\n}\n\nfunction trackDisplayedMessage(text) {\n  const hash = hashMessageContent(text);\n  displayedMessageHashes.add(hash);\n  // Clean old entries\n  if (displayedMessageHashes.size > MAX_DISPLAYED_HASHES) {\n    const iter = displayedMessageHashes.values();\n    for (let i = 0; i < 10; i++) displayedMessageHashes.delete(iter.next().value);\n  }\n}\n\nfunction isMessageDisplayed(text) {\n  return displayedMessageHashes.has(hashMessageContent(text));\n}\n\n// Check if user is scrolled near the bottom\nfunction isNearBottom(threshold = 100) {\n  if (!messagesEl) return true;\n  const { scrollTop, scrollHeight, clientHeight } = messagesEl;\n  return scrollHeight - scrollTop - clientHeight < threshold;\n}\n\n// Auto-scroll only if user is near bottom\nfunction scrollToBottomIfNeeded() {\n  if (isNearBottom()) {\n    messagesEl.scrollTop = messagesEl.scrollHeight;\n  }\n}\n\nfunction addMsg(text, type, options = {}) {\n  // If on intro page, DON'T auto-switch unless it's a user-initiated message\n  // This prevents sync/bot messages from interrupting the intro page\n  if (pageState === 'intro') {\n    if (options.userInitiated) {\n      // User sent a message - switch to chat feed\n      if (preloadedHistory && preloadedHistory.length > 0 && !historyRendered) {\n        renderPreloadedHistory();\n      }\n      showChatFeedPage({ skipHistory: true });\n    } else {\n      // Bot/sync message while on intro - just show toast, don't add to DOM\n      if (type === 'bot') {\n        toast('New message from Spark');\n      }\n      return null; // Don't add message to DOM\n    }\n  }\n  \n  // Track this message for deduplication\n  trackDisplayedMessage(text);\n  \n  const el = document.createElement('div');\n  el.className = `msg ${type}`;\n  \n  if (type === 'bot') {\n    el.innerHTML = formatMessage(text);\n  } else if (type === 'user') {\n    el.textContent = text;\n  } else {\n    el.textContent = text;\n  }\n  \n  messagesEl.appendChild(el);\n  \n  // Only auto-scroll if user is near bottom (allows scrolling up to read history)\n  // Exception: user messages always scroll to bottom\n  if (type === 'user') {\n    messagesEl.scrollTop = messagesEl.scrollHeight;\n  } else {\n    scrollToBottomIfNeeded();\n  }\n  return el;\n}\n\nfunction formatMessage(text) {\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    .replace(/`([^`]+)`/g, '<code>$1</code>')\n    .replace(/\\n\\n/g, '</p><p>')\n    .replace(/\\n/g, '<br>')\n    .replace(/^(.*)$/, '<p>$1</p>')\n    .replace(/<p><\\/p>/g, '');\n}\n\nfunction showThinking() {\n  // Don't show thinking indicator on intro page\n  if (pageState === 'intro') return;\n  \n  removeThinking();\n  const el = document.createElement('div');\n  el.className = 'msg bot thinking';\n  el.id = 'thinking-indicator';\n  el.innerHTML = '<div class=\"thinking-dots\"><span></span><span></span><span></span></div>';\n  messagesEl.appendChild(el);\n  scrollToBottomIfNeeded();\n}\n\nfunction removeThinking() {\n  document.getElementById('thinking-indicator')?.remove();\n}\n\nfunction setStatus(text) {\n  if (statusEl) {\n    statusEl.textContent = text;\n    statusEl.classList.toggle('show', !!text);\n  }\n}\n\nfunction toast(msg, isError = false) {\n  toastEl.textContent = msg;\n  toastEl.className = isError ? 'show error' : 'show';\n  setTimeout(() => toastEl.className = '', 3000);\n}\n\n// ============================================================================\n// VOICE MODE\n// ============================================================================\n// REALTIME VOICE MODE (OpenAI Realtime API)\n// ============================================================================\n\nlet realtimeWs = null;\nlet realtimeAudioContext = null;\nlet realtimeMediaStream = null;\nlet realtimeScriptProcessor = null;\nlet realtimePlaybackContext = null;\nlet audioQueue = [];\nlet isPlaying = false;\n\n// Waiting/thinking sound state\nlet thinkingAudio = null;\nlet thinkingInterval = null;\n\n// Create a simple, gentle thinking sound\nfunction createThinkingSound() {\n  const ctx = new (window.AudioContext || window.webkitAudioContext)();\n  const sampleRate = ctx.sampleRate;\n  const duration = 0.3; // Short 300ms pulse\n  const samples = duration * sampleRate;\n  const buffer = ctx.createBuffer(1, samples, sampleRate);\n  const data = buffer.getChannelData(0);\n  \n  // Simple soft \"ping\" sound\n  for (let i = 0; i < samples; i++) {\n    const t = i / sampleRate;\n    // Single gentle tone at 880Hz (A5)\n    const freq = 880;\n    // Quick fade out envelope\n    const env = Math.exp(-8 * t / duration);\n    // Simple sine wave\n    data[i] = env * 0.2 * Math.sin(2 * Math.PI * freq * t);\n  }\n  \n  return { ctx, buffer };\n}\n\n// Play the thinking sound in a loop\nfunction playWaitingSound() {\n  if (thinkingInterval) return; // Already playing\n  \n  console.log('\uD83D\uDD0A Thinking sound started');\n  \n  // Play initial sound\n  playThinkingPulse();\n  \n  // Loop every 2 seconds (less frequent, less annoying)\n  thinkingInterval = setInterval(playThinkingPulse, 2000);\n}\n\nfunction playThinkingPulse() {\n  let ctx = null;\n  try {\n    const result = createThinkingSound();\n    ctx = result.ctx;\n    const buffer = result.buffer;\n    const source = ctx.createBufferSource();\n    const gain = ctx.createGain();\n    \n    source.buffer = buffer;\n    gain.gain.setValueAtTime(0.2, ctx.currentTime); // Gentle volume\n    \n    source.connect(gain);\n    gain.connect(ctx.destination);\n    source.start();\n    \n    // Clean up after playing\n    source.onended = () => {\n      source.disconnect();\n      gain.disconnect();\n      ctx.close().catch(() => {});\n    };\n  } catch (e) {\n    console.error('Thinking sound error:', e);\n    // Close context on error to prevent memory leak\n    if (ctx && ctx.state !== 'closed') {\n      ctx.close().catch(() => {});\n    }\n  }\n}\n\n// Stop the thinking sound\nfunction stopWaitingSound() {\n  if (thinkingInterval) {\n    clearInterval(thinkingInterval);\n    thinkingInterval = null;\n    console.log('\uD83D\uDD07 Thinking sound stopped');\n  }\n}\n\n// Voice transcript message helpers\nlet currentUserMsg = null;\nlet currentAssistantMsg = null;\n\nfunction addVoiceMessage(role, text) {\n  if (!voiceContent) return null;\n  \n  const msg = document.createElement('div');\n  msg.className = `voice-msg ${role}`;\n  msg.textContent = text;\n  voiceContent.appendChild(msg);\n  \n  // Auto-scroll to bottom\n  voiceContent.scrollTop = voiceContent.scrollHeight;\n  \n  return msg;\n}\n\nfunction updateVoiceStatus(text) {\n  if (voiceStatus) {\n    voiceStatus.textContent = text;\n  }\n}\n\n// Build realtime WebSocket URL\nfunction getRealtimeWsUrl() {\n  const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';\n  const base = `${protocol}//${location.host}`;\n  const path = location.pathname.replace(/\\/+$/, '');\n  return path && path !== '/' ? `${base}${path}/realtime` : `${base}/realtime`;\n}\n\n// Convert Float32Array to base64 PCM16\nfunction float32ToBase64PCM16(float32Array) {\n  const pcm16 = new Int16Array(float32Array.length);\n  for (let i = 0; i < float32Array.length; i++) {\n    const s = Math.max(-1, Math.min(1, float32Array[i]));\n    pcm16[i] = s < 0 ? s * 0x8000 : s * 0x7FFF;\n  }\n  const bytes = new Uint8Array(pcm16.buffer);\n  let binary = '';\n  for (let i = 0; i < bytes.length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return btoa(binary);\n}\n\n// Convert base64 PCM16 to Float32Array\nfunction base64PCM16ToFloat32(base64) {\n  const binary = atob(base64);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i++) {\n    bytes[i] = binary.charCodeAt(i);\n  }\n  const pcm16 = new Int16Array(bytes.buffer);\n  const float32 = new Float32Array(pcm16.length);\n  for (let i = 0; i < pcm16.length; i++) {\n    float32[i] = pcm16[i] / (pcm16[i] < 0 ? 0x8000 : 0x7FFF);\n  }\n  return float32;\n}\n\n// Play audio from queue (PCM16 format - legacy realtime mode)\nasync function playAudioQueue() {\n  if (isPlaying || audioQueue.length === 0) return;\n  isPlaying = true;\n  \n  while (audioQueue.length > 0) {\n    const audioData = audioQueue.shift();\n    try {\n      if (!realtimePlaybackContext) {\n        realtimePlaybackContext = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: 24000 });\n      }\n      \n      const float32 = base64PCM16ToFloat32(audioData);\n      const audioBuffer = realtimePlaybackContext.createBuffer(1, float32.length, 24000);\n      audioBuffer.getChannelData(0).set(float32);\n      \n      const source = realtimePlaybackContext.createBufferSource();\n      source.buffer = audioBuffer;\n      source.connect(realtimePlaybackContext.destination);\n      \n      await new Promise(resolve => {\n        source.onended = resolve;\n        source.start();\n      });\n    } catch (e) {\n      console.error('Audio playback error:', e);\n    }\n  }\n  \n  // Small delay before lowering volume gate\n  await new Promise(r => setTimeout(r, 100));\n  isPlaying = false;\n}\n\n// TTS audio buffer for reassembly\nlet ttsAudioBuffer = [];\n\n// Play audio from queue (TTS API format - hybrid mode)\n// OpenAI TTS returns raw PCM at 24000Hz\nasync function playAudioQueueTTS() {\n  if (isPlaying) return;\n  \n  // Collect all chunks first (TTS chunks need to be played together)\n  while (audioQueue.length > 0) {\n    ttsAudioBuffer.push(audioQueue.shift());\n  }\n  \n  // If we have accumulated audio, play it\n  if (ttsAudioBuffer.length > 0) {\n    isPlaying = true;\n    let ctx = null;\n    \n    try {\n      // Combine all base64 chunks\n      const combinedBase64 = ttsAudioBuffer.join('');\n      ttsAudioBuffer = [];\n      \n      // Convert base64 to raw bytes\n      const binary = atob(combinedBase64);\n      const bytes = new Uint8Array(binary.length);\n      for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n      }\n      \n      // OpenAI TTS PCM format: 24000Hz, 16-bit signed little-endian\n      const pcm16 = new Int16Array(bytes.buffer);\n      const float32 = new Float32Array(pcm16.length);\n      for (let i = 0; i < pcm16.length; i++) {\n        float32[i] = pcm16[i] / (pcm16[i] < 0 ? 0x8000 : 0x7FFF);\n      }\n      \n      // Create audio context and play\n      ctx = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: 24000 });\n      const audioBuffer = ctx.createBuffer(1, float32.length, 24000);\n      audioBuffer.getChannelData(0).set(float32);\n      \n      const source = ctx.createBufferSource();\n      source.buffer = audioBuffer;\n      source.connect(ctx.destination);\n      \n      await new Promise(resolve => {\n        source.onended = () => {\n          ctx.close().catch(() => {});\n          resolve();\n        };\n        source.start();\n      });\n      \n      // CRITICAL: Notify server that playback finished so it can resume listening\n      if (hybridWs && hybridWs.readyState === WebSocket.OPEN) {\n        hybridWs.send(JSON.stringify({ type: 'audio_playback_ended' }));\n        console.log('\uD83D\uDD0A Notified server: playback ended');\n      }\n      \n    } catch (e) {\n      console.error('TTS playback error:', e);\n      // Close context on error to prevent memory leak\n      if (ctx && ctx.state !== 'closed') {\n        ctx.close().catch(() => {});\n      }\n      // Still notify server even on error\n      if (hybridWs && hybridWs.readyState === WebSocket.OPEN) {\n        hybridWs.send(JSON.stringify({ type: 'audio_playback_ended' }));\n      }\n    }\n    \n    // Small delay before lowering volume gate\n    await new Promise(r => setTimeout(r, 100));\n    isPlaying = false;\n  }\n}\n\n// Stop audio playback\nfunction stopAudioPlayback() {\n  audioQueue = [];\n  isPlaying = false;\n  if (realtimePlaybackContext) {\n    realtimePlaybackContext.close().catch(() => {});\n    realtimePlaybackContext = null;\n  }\n}\n\n// Wave animation state (CSS-based, JS just tracks analyser for speaking detection)\nlet waveAnimationFrame = null;\nlet analyserNode = null;\n\n// Start monitoring audio for speaking detection\nfunction startWaveAnimation() {\n  // CSS handles the actual animation, we just detect speaking state\n  function checkSpeaking() {\n    if (analyserNode) {\n      const dataArray = new Uint8Array(analyserNode.frequencyBinCount);\n      analyserNode.getByteFrequencyData(dataArray);\n      \n      let sum = 0;\n      for (let i = 0; i < dataArray.length; i++) {\n        sum += dataArray[i];\n      }\n      const amplitude = (sum / dataArray.length) / 255;\n      const isSpeaking = amplitude > 0.05;\n      \n      // Toggle speaking class on voice-bar\n      const voiceBar = document.getElementById('voice-bar');\n      if (voiceBar) {\n        voiceBar.classList.toggle('speaking', isSpeaking);\n      }\n    }\n    waveAnimationFrame = requestAnimationFrame(checkSpeaking);\n  }\n  checkSpeaking();\n}\n\n// Stop wave animation monitoring\nfunction stopWaveAnimation() {\n  if (waveAnimationFrame) {\n    cancelAnimationFrame(waveAnimationFrame);\n    waveAnimationFrame = null;\n  }\n  const voiceBar = document.getElementById('voice-bar');\n  if (voiceBar) {\n    voiceBar.classList.remove('speaking');\n  }\n}\n\n// Start audio capture and streaming\nasync function startAudioCapture() {\n  try {\n    // Check if getUserMedia is available\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n      toast('Microphone not supported in this browser', true);\n      return false;\n    }\n    \n    realtimeAudioContext = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: 24000 });\n    \n    // Request microphone access with specific error handling\n    try {\n      realtimeMediaStream = await navigator.mediaDevices.getUserMedia({ \n        audio: { \n          sampleRate: 24000,\n          channelCount: 1,\n          echoCancellation: true,\n          noiseSuppression: true\n        } \n      });\n    } catch (micError) {\n      // Specific error handling for microphone access\n      if (micError.name === 'NotAllowedError') {\n        toast('Microphone permission denied. Please allow access.', true);\n      } else if (micError.name === 'NotFoundError') {\n        toast('No microphone found', true);\n      } else {\n        toast('Microphone error: ' + micError.message, true);\n      }\n      console.error('Microphone access error:', micError);\n      \n      // Clean up audio context on failure\n      if (realtimeAudioContext) {\n        realtimeAudioContext.close().catch(() => {});\n        realtimeAudioContext = null;\n      }\n      return false;\n    }\n    \n    const source = realtimeAudioContext.createMediaStreamSource(realtimeMediaStream);\n    \n    // Add analyser for wave visualization\n    analyserNode = realtimeAudioContext.createAnalyser();\n    analyserNode.fftSize = 256;\n    source.connect(analyserNode);\n    \n    // Start wave animation\n    startWaveAnimation();\n    \n    // Use ScriptProcessorNode for capturing audio (deprecated but widely supported)\n    realtimeScriptProcessor = realtimeAudioContext.createScriptProcessor(4096, 1, 1);\n    \n    realtimeScriptProcessor.onaudioprocess = (e) => {\n      if (realtimeWs && realtimeWs.readyState === WebSocket.OPEN) {\n        const inputData = e.inputBuffer.getChannelData(0);\n        \n        // Calculate RMS volume\n        let sum = 0;\n        for (let i = 0; i < inputData.length; i++) {\n          sum += inputData[i] * inputData[i];\n        }\n        const rms = Math.sqrt(sum / inputData.length);\n        \n        // While playing: only send if volume is high (user interrupting)\n        // Echo is typically ~0.01-0.03 RMS, direct speech is ~0.05-0.2+\n        if (isPlaying && rms < 0.04) return;\n        \n        const base64Audio = float32ToBase64PCM16(inputData);\n        realtimeWs.send(JSON.stringify({ type: 'audio', data: base64Audio }));\n      }\n    };\n    \n    source.connect(realtimeScriptProcessor);\n    realtimeScriptProcessor.connect(realtimeAudioContext.destination);\n    \n    console.log('\uD83C\uDFA4 Audio capture started');\n    return true;\n  } catch (e) {\n    console.error('Audio capture error:', e);\n    toast('Audio initialization failed: ' + e.message, true);\n    // Clean up on any unexpected error\n    if (realtimeAudioContext) {\n      realtimeAudioContext.close().catch(() => {});\n      realtimeAudioContext = null;\n    }\n    return false;\n  }\n}\n\n// Stop audio capture\nfunction stopAudioCapture() {\n  // Stop wave animation\n  stopWaveAnimation();\n  analyserNode = null;\n  \n  if (realtimeScriptProcessor) {\n    realtimeScriptProcessor.disconnect();\n    realtimeScriptProcessor = null;\n  }\n  if (realtimeMediaStream) {\n    realtimeMediaStream.getTracks().forEach(t => t.stop());\n    realtimeMediaStream = null;\n  }\n  if (realtimeAudioContext) {\n    realtimeAudioContext.close().catch(() => {});\n    realtimeAudioContext = null;\n  }\n  console.log('\uD83C\uDFA4 Audio capture stopped');\n}\n\n// Connect to realtime WebSocket\nfunction connectRealtime() {\n  const url = getRealtimeWsUrl();\n  console.log('\uD83D\uDD17 Connecting to realtime:', url);\n  \n  realtimeWs = new WebSocket(url);\n  \n  realtimeWs.onopen = async () => {\n    realtimeReconnectAttempts = 0;\n    console.log('\u2705 Realtime connected');\n    setStatus('');\n    \n    // Start audio capture\n    const started = await startAudioCapture();\n    if (!started) {\n      stopVoice();\n    }\n  };\n  \n  realtimeWs.onmessage = (e) => {\n    try {\n      const msg = JSON.parse(e.data);\n      handleRealtimeMessage(msg);\n    } catch (err) {\n      console.error('Failed to parse realtime message:', err);\n    }\n  };\n  \n  realtimeWs.onclose = () => {\n    console.log('\uD83D\uDD0C Realtime disconnected');\n    if (isListening && realtimeReconnectAttempts < MAX_RECONNECT_ATTEMPTS) {\n      const delay = Math.min(2000 * Math.pow(2, realtimeReconnectAttempts), 30000);\n      realtimeReconnectAttempts++;\n      setStatus(`Reconnecting (${realtimeReconnectAttempts}/${MAX_RECONNECT_ATTEMPTS})...`);\n      setTimeout(connectRealtime, delay);\n    } else if (realtimeReconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n      toast('Voice connection failed. Please try again.', true);\n      stopVoice();\n    }\n  };\n  \n  realtimeWs.onerror = (e) => {\n    console.error('Realtime WebSocket error:', e);\n  };\n}\n\n// Handle messages from realtime server (supports both legacy and hybrid modes)\nfunction handleRealtimeMessage(msg) {\n  switch (msg.type) {\n    case 'ready':\n      const modeLabel = msg.mode === 'hybrid' ? 'Hybrid (Claude)' : 'Direct';\n      console.log(`\uD83C\uDF99\uFE0F Realtime session ready - Mode: ${modeLabel}`);\n      updateVoiceStatus('Listening');\n      break;\n      \n    case 'user_speaking':\n      setVoiceActive(true);\n      updateVoiceStatus('Hearing you...');\n      // Stop any playing audio when user speaks (interruption)\n      stopAudioPlayback();\n      stopWaitingSound();\n      // Reset for new turn\n      currentUserMsg = null;\n      currentAssistantMsg = null;\n      break;\n      \n    case 'user_stopped':\n      setVoiceActive(false);\n      updateVoiceStatus('Processing...');\n      // Start thinking sound when user stops speaking\n      playWaitingSound();\n      break;\n      \n    case 'interim':\n    case 'transcript':\n      // User's transcribed speech\n      stopWaitingSound();\n      if (msg.text && voiceContent) {\n        if (!currentUserMsg) {\n          // Create user message element\n          const userMsg = document.createElement('div');\n          userMsg.className = 'voice-msg user';\n          userMsg.textContent = msg.text;\n          \n          // If assistant already started responding, insert BEFORE it\n          if (currentAssistantMsg && currentAssistantMsg.parentNode === voiceContent) {\n            voiceContent.insertBefore(userMsg, currentAssistantMsg);\n          } else {\n            voiceContent.appendChild(userMsg);\n          }\n          currentUserMsg = userMsg;\n        } else {\n          currentUserMsg.textContent = msg.text;\n        }\n        voiceContent.scrollTop = voiceContent.scrollHeight;\n      }\n      playWaitingSound();\n      break;\n    \n    case 'processing':\n      // Hybrid mode: processing with Spark Opus\n      const engineName = msg.engine || 'Spark Opus';\n      const statusMsg = msg.message || `Checking with ${engineName}...`;\n      console.log(`\uD83E\uDDE0 ${statusMsg}`);\n      updateVoiceStatus(statusMsg);\n      playWaitingSound();\n      if (!currentAssistantMsg) {\n        currentAssistantMsg = addVoiceMessage('assistant', statusMsg);\n        currentAssistantMsg.classList.add('thinking');\n      } else {\n        currentAssistantMsg.textContent = statusMsg;\n        currentAssistantMsg.classList.add('thinking');\n      }\n      break;\n      \n    case 'text_delta':\n      // AI response streaming text (legacy mode)\n      stopWaitingSound();\n      updateVoiceStatus('Speaking...');\n      if (msg.delta) {\n        if (!currentAssistantMsg) {\n          currentAssistantMsg = addVoiceMessage('assistant', msg.delta);\n        } else {\n          currentAssistantMsg.textContent += msg.delta;\n          currentAssistantMsg.classList.remove('thinking');\n        }\n        // Auto-scroll\n        if (voiceContent) voiceContent.scrollTop = voiceContent.scrollHeight;\n      }\n      break;\n      \n    case 'text':\n      // Full AI response text\n      stopWaitingSound();\n      if (msg.content) {\n        if (!currentAssistantMsg) {\n          currentAssistantMsg = addVoiceMessage('assistant', msg.content);\n        } else {\n          currentAssistantMsg.textContent = msg.content;\n          currentAssistantMsg.classList.remove('thinking');\n        }\n      }\n      break;\n    \n    case 'tts_start':\n      // Hybrid mode: TTS generation starting\n      console.log('\uD83D\uDD0A Generating speech...');\n      updateVoiceStatus('Speaking...');\n      stopWaitingSound();\n      break;\n    \n    case 'audio_chunk':\n      // Hybrid mode: audio chunk (TTS API format - needs conversion)\n      stopWaitingSound();\n      updateVoiceStatus('Speaking...');\n      if (msg.data) {\n        // Queue audio chunk for playback\n        audioQueue.push(msg.data);\n        playAudioQueueTTS();\n      }\n      break;\n      \n    case 'audio_delta':\n      // Audio chunk from AI (legacy mode - PCM16)\n      stopWaitingSound();\n      updateVoiceStatus('Speaking...');\n      if (msg.data) {\n        audioQueue.push(msg.data);\n        playAudioQueue();\n      }\n      break;\n      \n    case 'audio_done':\n      console.log('\uD83D\uDD0A Audio complete');\n      break;\n      \n    case 'tool_call':\n      // Tool is being executed - show feedback and play waiting sound\n      console.log('\uD83D\uDD27 Tool call:', msg.name);\n      const toolName = msg.name?.replace('get_', '').replace('ask_', '').replace('_', ' ') || 'info';\n      updateVoiceStatus(`Checking ${toolName}...`);\n      // Add a thinking message\n      if (!currentAssistantMsg) {\n        currentAssistantMsg = addVoiceMessage('assistant', `Checking ${toolName}...`);\n        currentAssistantMsg.classList.add('thinking');\n      }\n      playWaitingSound();\n      break;\n      \n    case 'done':\n      // Response complete - reset for next turn (but keep messages!)\n      stopWaitingSound();\n      currentUserMsg = null;\n      currentAssistantMsg = null;\n      updateVoiceStatus('Listening');\n      break;\n      \n    case 'error':\n      stopWaitingSound();\n      console.error('Realtime error:', msg.message);\n      toast(msg.message || 'Voice error', true);\n      updateVoiceStatus('Error');\n      break;\n      \n    case 'disconnected':\n      stopWaitingSound();\n      if (isListening) {\n        toast('Disconnected', true);\n      }\n      break;\n  }\n}\n\nfunction startVoice() {\n  mode = 'voice';\n  isListening = true;\n  document.body.classList.add('voice-mode');\n  bottomEl?.classList.add('voice-active');\n  \n  // Reset message state\n  currentUserMsg = null;\n  currentAssistantMsg = null;\n  \n  // Update status indicator\n  updateVoiceStatus('Connecting...');\n  setStatus('Connecting...');\n  connectRealtime();\n}\n\nfunction stopVoice() {\n  isListening = false;\n  document.body.classList.remove('voice-mode');\n  bottomEl?.classList.remove('voice-active');\n  voiceBar?.classList.remove('speaking');\n  \n  // Reset message state\n  currentUserMsg = null;\n  currentAssistantMsg = null;\n  \n  // Stop audio capture\n  stopAudioCapture();\n  \n  // Stop playback\n  stopAudioPlayback();\n  \n  // Close realtime WebSocket\n  if (realtimeWs) {\n    realtimeWs.send(JSON.stringify({ type: 'stop' }));\n    realtimeWs.close();\n    realtimeWs = null;\n  }\n  \n  mode = 'chat';\n}\n\nfunction setVoiceActive(active) {\n  voiceBar?.classList.toggle('speaking', active);\n}\n\nvoiceBtn?.addEventListener('click', startVoice);\ncloseVoiceBtn?.addEventListener('click', stopVoice);\n\n// ============================================================================\n// CHAT MODE\n// ============================================================================\n\ntextInput?.addEventListener('input', () => {\n  const hasText = textInput.value.trim().length > 0 || pendingAttachment;\n  sendBtn?.classList.toggle('show', hasText);\n  voiceBtn?.classList.toggle('hidden', hasText);\n  \n  // Auto-resize textarea\n  if (textInput) {\n    textInput.style.height = 'auto';\n    textInput.style.height = Math.min(textInput.scrollHeight, 120) + 'px';\n  }\n});\n\ntextInput?.addEventListener('keydown', (e) => {\n  if (e.key === 'Enter' && !e.shiftKey) {\n    e.preventDefault();\n    submitText();\n  }\n});\n\ntextInput?.addEventListener('focus', () => {\n  if (isListening) stopVoice();\n  mode = 'chat';\n  bottomEl?.classList.add('focused');\n});\n\ntextInput?.addEventListener('blur', () => {\n  setTimeout(() => {\n    if (document.activeElement !== textInput) {\n      bottomEl?.classList.remove('focused');\n    }\n  }, 100);\n});\n\nsendBtn?.addEventListener('click', submitText);\n\nasync function submitText() {\n  const text = textInput?.value.trim();\n  if (!text || isProcessing) return;\n  textInput.value = '';\n  textInput.style.height = 'auto'; // Reset height\n  sendBtn?.classList.remove('show');\n  voiceBtn?.classList.remove('hidden'); // Reset voice button visibility\n  await send(text, 'chat');\n}\n\n// ============================================================================\n// NOTES MODE\n// ============================================================================\n\nasync function initRecorder() {\n  try {\n    mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n    mediaRecorder = new MediaRecorder(mediaStream);\n    mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) audioChunks.push(e.data); };\n    mediaRecorder.onstop = finishRecording;\n    return true;\n  } catch {\n    toast('Mic access denied', true);\n    return false;\n  }\n}\n\nfunction releaseMicrophone() {\n  mediaStream?.getTracks().forEach(t => t.stop());\n  mediaStream = null;\n  mediaRecorder = null;\n}\n\nfunction startRecording() {\n  if (!mediaRecorder) {\n    initRecorder().then(ok => ok && startRecording());\n    return;\n  }\n  audioChunks = [];\n  mediaRecorder.start();\n  recordStart = Date.now();\n  mode = 'notes';\n  document.body.classList.add('notes-mode');\n  bottomEl?.classList.add('notes-active');\n  timerInterval = setInterval(updateTimer, 1000);\n  updateTimer();\n}\n\nfunction stopRecording() {\n  if (mediaRecorder?.state !== 'recording') return;\n  mediaRecorder.stop();\n  clearInterval(timerInterval);\n  document.body.classList.remove('notes-mode');\n  bottomEl?.classList.remove('notes-active');\n  mode = 'chat';\n}\n\nfunction discardRecording() {\n  if (mediaRecorder?.state !== 'recording') return;\n  mediaRecorder.onstop = () => { toast('Recording discarded'); releaseMicrophone(); };\n  mediaRecorder.stop();\n  clearInterval(timerInterval);\n  audioChunks = [];\n  document.body.classList.remove('notes-mode');\n  bottomEl?.classList.remove('notes-active');\n  mode = 'chat';\n}\n\nfunction updateTimer() {\n  const s = Math.floor((Date.now() - recordStart) / 1000);\n  if (notesTimerEl) notesTimerEl.textContent = `${Math.floor(s/60)}:${(s%60).toString().padStart(2,'0')}`;\n}\n\nasync function finishRecording() {\n  const blob = new Blob(audioChunks, { type: 'audio/webm' });\n  const duration = Math.floor((Date.now() - recordStart) / 1000);\n  releaseMicrophone();\n  addMsg(`\uD83C\uDF99\uFE0F Voice note (${Math.floor(duration/60)}:${(duration%60).toString().padStart(2,'0')})`, 'system');\n  const reader = new FileReader();\n  reader.onload = () => sendNote(reader.result.split(',')[1], duration);\n  reader.readAsDataURL(blob);\n}\n\nfunction sendNote(audio, duration) {\n  if (!ws || ws.readyState !== WebSocket.OPEN) {\n    toast('Not connected', true);\n    return;\n  }\n  isProcessing = true;\n  addMsg('Transcribing...', 'system');\n  ws.send(JSON.stringify({ type: 'voice_note', audio, duration }));\n}\n\nnotesBtn?.addEventListener('click', () => { if (isListening) stopVoice(); startRecording(); });\ncloseNotesBtn?.addEventListener('click', stopRecording);\ndeleteNotesBtn?.addEventListener('click', discardRecording);\n\n// ============================================================================\n// WEBSOCKET\n// ============================================================================\n\n// Session persistence\nlet chatSessionId = localStorage.getItem('spark_session_id');\nlet lastMessageTimestamp = 0; // Track last received message time for catch-up\nlet isReconnecting = false;\n\n// Catch up on missed messages after reconnection\nasync function catchUpMissedMessages() {\n  if (pageState !== 'chatfeed') return; // Only catch up if viewing chat\n  \n  try {\n    console.log('\uD83D\uDD04 Catching up on missed messages since:', lastMessageTimestamp);\n    const res = await fetch(`/api/messages/recent?since=${lastMessageTimestamp}`);\n    if (!res.ok) return;\n    \n    const data = await res.json();\n    const messages = data.messages || [];\n    \n    if (messages.length === 0) {\n      console.log('\uD83D\uDD04 No missed messages');\n      return;\n    }\n    \n    console.log(`\uD83D\uDD04 Found ${messages.length} missed message(s)`);\n    \n    for (const msg of messages) {\n      // Skip duplicates\n      if (isMessageDisplayed(msg.text)) continue;\n      \n      trackDisplayedMessage(msg.text);\n      \n      const el = document.createElement('div');\n      el.className = `msg ${msg.role === 'user' ? 'user' : 'bot'}`;\n      if (msg.role === 'user') {\n        el.textContent = msg.text;\n      } else {\n        el.innerHTML = formatMessage(msg.text);\n      }\n      messagesEl.appendChild(el);\n      \n      // Update last timestamp\n      if (msg.timestamp > lastMessageTimestamp) {\n        lastMessageTimestamp = msg.timestamp;\n      }\n    }\n    \n    scrollToBottomIfNeeded();\n  } catch (e) {\n    console.error('Catch-up failed:', e);\n  }\n}\n\nfunction connect() {\n  // Build URL with session ID for reconnection\n  let wsUrl = CONFIG.wsUrl;\n  if (chatSessionId) {\n    wsUrl += (wsUrl.includes('?') ? '&' : '?') + `session=${chatSessionId}`;\n  }\n  \n  console.log('\uD83D\uDD0C Connecting to:', wsUrl);\n  updateSparkStatus('connecting');\n  try {\n    ws = new WebSocket(wsUrl);\n    ws.onopen = () => {\n      console.log('\u2705 Chat WebSocket connected');\n      updateSparkStatus('connected');\n      \n      // Catch up on any missed messages during disconnection\n      if (isReconnecting) {\n        catchUpMissedMessages();\n      }\n      isReconnecting = false;\n    };\n    ws.onclose = (e) => {\n      console.log('\uD83D\uDD0C Chat WebSocket closed:', e.code, e.reason);\n      updateSparkStatus('disconnected');\n      isReconnecting = true; // Mark that next connect is a reconnection\n      setTimeout(connect, 2000);\n    };\n    ws.onerror = (e) => {\n      console.error('\u274C Chat WebSocket error:', e);\n      updateSparkStatus('disconnected');\n    };\n    \n    // Reconnect when page becomes visible (fixes mobile Safari background disconnect)\n    document.addEventListener('visibilitychange', () => {\n      if (document.visibilityState === 'visible') {\n        console.log('\uD83D\uDC41\uFE0F Page visible, checking WebSocket...');\n        if (!ws || ws.readyState !== WebSocket.OPEN) {\n          console.log('\uD83D\uDD04 WebSocket stale, reconnecting...');\n          connect();\n        } else {\n          // Connection looks good, but catch up on any missed messages\n          catchUpMissedMessages();\n        }\n      }\n    });\n    ws.onmessage = (e) => { \n      try { \n        const data = JSON.parse(e.data);\n        console.log('\uD83D\uDCE8 WS received:', data.type, data.content?.slice?.(0, 50) || '');\n        handle(data); \n      } catch (err) {\n        console.error('\u274C WS message error:', err, e.data?.slice?.(0, 100));\n      } \n    };\n  } catch (e) {\n    console.error('\u274C Failed to create WebSocket:', e);\n    updateSparkStatus('disconnected');\n  }\n}\n\nasync function send(text, sendMode) {\n  if (!ws || ws.readyState !== WebSocket.OPEN) {\n    toast('Not connected', true);\n    return;\n  }\n  \n  // If on intro page, ensure history is loaded before showing chat feed\n  // This prevents the \"blank space\" issue where user's message appears alone\n  if (pageState === 'intro') {\n    // Wait for history to load (should already be loaded, but ensure it)\n    if (historyLoadPromise) {\n      try {\n        await historyLoadPromise;\n        console.log('\uD83D\uDCDC History ready, preloaded:', preloadedHistory?.length || 0, 'messages');\n      } catch (e) {\n        console.log('History load failed, continuing anyway');\n      }\n    }\n    \n    // Render history BEFORE switching to chat feed and adding user message\n    // Skip this if we're in a mode (mode has its own history)\n    if (!currentSparkMode && preloadedHistory && preloadedHistory.length > 0 && !historyRendered) {\n      console.log('\uD83D\uDCDC Rendering history before first message');\n      renderPreloadedHistory();\n    }\n    \n    // Now switch to chat feed (history already rendered)\n    showChatFeedPage({ skipHistory: true });\n  }\n  \n  isProcessing = true;\n  updateSparkPillText();\n  \n  // Add user message (history should already be rendered above if on intro)\n  const el = document.createElement('div');\n  el.className = 'msg user';\n  el.textContent = text;\n  messagesEl.appendChild(el);\n  messagesEl.scrollTop = messagesEl.scrollHeight;\n  \n  // Track message to prevent duplicate from sync\n  trackDisplayedMessage(text);\n  \n  showThinking();\n  \n  // Route to mode session or main session\n  if (currentSparkMode) {\n    // Send to mode-specific session\n    console.log(`\uD83D\uDCE6 Sending to ${currentSparkMode} mode session`);\n    ws.send(JSON.stringify({ type: 'mode_message', sparkMode: currentSparkMode, text }));\n  } else {\n    // Send to main session\n    ws.send(JSON.stringify({ type: 'transcript', text, mode: sendMode, model: currentModel }));\n  }\n}\n\nfunction handle(data) {\n  switch (data.type) {\n    case 'ready': \n      // Store session ID for reconnection (local only, unified session handled server-side)\n      if (data.sessionId) {\n        chatSessionId = data.sessionId;\n        localStorage.setItem('spark_session_id', data.sessionId);\n        console.log('\uD83D\uDCCB Session:', data.sessionId);\n      }\n      // Check if there's a pending request\n      if (data.pending) {\n        console.log('\u23F3 Pending request detected - showing loading');\n        showThinking();\n      }\n      console.log('\u2705 Chat ready');\n      break;\n    \n    case 'sync':\n      // Real-time sync: new message from WhatsApp or other surface\n      console.log('\uD83D\uDCE1 Sync message:', data.message?.source, data.message?.text?.slice(0, 50));\n      refreshHistoryCache(); // Keep history cache up to date\n      if (data.message && data.message.text) {\n        // Track timestamp for catch-up on reconnect\n        if (data.message.timestamp && data.message.timestamp > lastMessageTimestamp) {\n          lastMessageTimestamp = data.message.timestamp;\n        }\n        \n        // Check for duplicates using hash-based tracking\n        if (isMessageDisplayed(data.message.text)) {\n          console.log('\uD83D\uDCE1 Skipping duplicate sync message (hash match)');\n          break;\n        }\n        \n        // Show on chat feed if we're viewing it\n        if (pageState === 'chatfeed') {\n          // Track and display\n          trackDisplayedMessage(data.message.text);\n          \n          const el = document.createElement('div');\n          el.className = `msg ${data.message.role === 'user' ? 'user' : 'bot'}`;\n          if (data.message.role === 'user') {\n            el.textContent = data.message.text;\n          } else {\n            el.innerHTML = formatMessage(data.message.text);\n          }\n          // Add source indicator for WhatsApp messages\n          if (data.message.source === 'whatsapp') {\n            el.title = 'From WhatsApp';\n          }\n          messagesEl.appendChild(el);\n          // Auto-scroll only if near bottom\n          scrollToBottomIfNeeded();\n          \n          // Remove thinking indicator if this is a bot response\n          if (data.message.role === 'bot') {\n            removeThinking();\n          }\n        } else if (pageState === 'intro') {\n          // Show toast notification on intro page for new messages\n          if (data.message.role === 'bot') {\n            toast('New message from Spark');\n          }\n        }\n      }\n      break;\n    case 'thinking':\n      // Server acknowledged request and is processing\n      console.log('\uD83E\uDD14 Server thinking...');\n      // Route to session page if active\n      if (currentSessionMode && sessionPage.classList.contains('show')) {\n        showSessionThinking();\n      } else {\n        showThinking();\n      }\n      break;\n    case 'text':\n      console.log('\u2705 Text message received:', data.content?.slice?.(0, 100));\n      // Route to session page if active\n      if (currentSessionMode && sessionPage.classList.contains('show')) {\n        removeSessionThinking();\n        if (data.content) {\n          addSessionMessage('bot', data.content);\n          // Update session status\n          sessionStatus.textContent = '\u25CF Active';\n          sessionStatus.classList.add('active');\n        }\n      } else {\n        removeThinking();\n        setStatus('');\n        const lastSys = messagesEl?.querySelector('.msg.system:last-child');\n        if (lastSys?.textContent === 'Transcribing...') lastSys.remove();\n        if (data.content) {\n          addMsg(data.content, 'bot');\n          console.log('\u2705 Bot message added to DOM');\n        } else {\n          console.warn('\u26A0\uFE0F Empty text content received');\n        }\n      }\n      break;\n    case 'transcription':\n      const transSys = messagesEl?.querySelector('.msg.system:last-child');\n      if (transSys?.textContent === 'Transcribing...') transSys.remove();\n      addMsg('\uD83D\uDCDD ' + data.text, 'bot');\n      break;\n    case 'audio': playAudio(data.data); break;\n    case 'done':\n      isProcessing = false;\n      sessionPageProcessing = false;\n      setStatus('');\n      updateSparkPillText();\n      fetchActiveSessions(); // Refresh sessions after response\n      checkActiveSubagentSessions(); // Refresh mode button states\n      refreshHistoryCache(); // Keep history cache up to date\n      if (mode === 'voice' && !isListening) startVoice();\n      break;\n    case 'error':\n      // Route to session page if active\n      if (currentSessionMode && sessionPage.classList.contains('show')) {\n        removeSessionThinking();\n        addSessionMessage('bot', `Error: ${data.message || 'Something went wrong'}`);\n        sessionPageProcessing = false;\n      } else {\n        removeThinking();\n      }\n      toast(data.message || 'Error', true);\n      isProcessing = false;\n      setStatus('');\n      updateSparkPillText();\n      fetchActiveSessions();\n      break;\n    \n    case 'mode_history':\n      // Received history from a mode session\n      console.log(`\uD83D\uDCE6 Mode history received for ${data.mode}:`, data.messages?.length || 0, 'messages');\n      if (data.mode && data.messages) {\n        modeHistory[data.mode] = data.messages;\n        // If we're currently in this mode, render the history\n        if (currentSparkMode === data.mode) {\n          renderModeHistory(data.mode);\n        }\n      }\n      break;\n  }\n}\n\n// ============================================================================\n// AUDIO\n// ============================================================================\n\nasync function playAudio(base64) {\n  if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();\n  try {\n    const bytes = Uint8Array.from(atob(base64), c => c.charCodeAt(0));\n    const buffer = await audioContext.decodeAudioData(bytes.buffer.slice(0));\n    if (currentAudio) try { currentAudio.stop(); } catch {}\n    currentAudio = audioContext.createBufferSource();\n    currentAudio.buffer = buffer;\n    currentAudio.connect(audioContext.destination);\n    currentAudio.start(0);\n  } catch (e) { console.error('Audio error:', e); }\n}\n\n// ============================================================================\n// MESSAGE CONTEXT MENU (long-press)\n// ============================================================================\n\nconst msgMenu = document.getElementById('msg-menu');\nconst menuCopy = document.getElementById('menu-copy');\nconst menuEdit = document.getElementById('menu-edit');\nconst menuDelete = document.getElementById('menu-delete');\n\nlet selectedMsg = null;\nlet longPressTimer = null;\n\nfunction showMsgMenu(msgEl, x, y) {\n  selectedMsg = msgEl;\n  msgEl.classList.add('selected');\n  \n  // Position menu near the touch point\n  const menuWidth = 148; // 3 buttons * ~44px + padding\n  const menuHeight = 60;\n  \n  // Keep menu on screen\n  const finalX = Math.min(x, window.innerWidth - menuWidth - 10);\n  const finalY = Math.max(y - menuHeight - 10, 10);\n  \n  msgMenu.style.left = finalX + 'px';\n  msgMenu.style.top = finalY + 'px';\n  msgMenu.classList.add('show');\n}\n\nfunction hideMsgMenu() {\n  msgMenu?.classList.remove('show');\n  selectedMsg?.classList.remove('selected');\n  selectedMsg = null;\n}\n\n// Long-press detection on messages\nmessagesEl?.addEventListener('touchstart', (e) => {\n  const msgEl = e.target.closest('.msg');\n  if (!msgEl || msgEl.classList.contains('system') || msgEl.classList.contains('thinking')) return;\n  \n  const touch = e.touches[0];\n  longPressTimer = setTimeout(() => {\n    e.preventDefault();\n    showMsgMenu(msgEl, touch.clientX, touch.clientY);\n  }, 500);\n}, { passive: false });\n\nmessagesEl?.addEventListener('touchend', () => {\n  clearTimeout(longPressTimer);\n});\n\nmessagesEl?.addEventListener('touchmove', () => {\n  clearTimeout(longPressTimer);\n});\n\n// Hide menu on tap elsewhere\ndocument.addEventListener('touchstart', (e) => {\n  if (!e.target.closest('#msg-menu') && !e.target.closest('.msg')) {\n    hideMsgMenu();\n  }\n});\n\n// Copy action\nmenuCopy?.addEventListener('click', () => {\n  if (!selectedMsg) return;\n  const text = selectedMsg.textContent || selectedMsg.innerText;\n  navigator.clipboard.writeText(text).then(() => {\n    toast('Copied!');\n  }).catch(() => {\n    toast('Failed to copy', true);\n  });\n  hideMsgMenu();\n});\n\n// Edit action (puts text in input)\nmenuEdit?.addEventListener('click', () => {\n  if (!selectedMsg) return;\n  const text = selectedMsg.textContent || selectedMsg.innerText;\n  if (textInput) {\n    textInput.value = text;\n    textInput.style.height = 'auto';\n    textInput.style.height = Math.min(textInput.scrollHeight, 120) + 'px';\n    sendBtn?.classList.add('show');\n    textInput.focus();\n  }\n  hideMsgMenu();\n});\n\n// Delete action\nmenuDelete?.addEventListener('click', () => {\n  if (!selectedMsg) return;\n  selectedMsg.remove();\n  toast('Deleted');\n  hideMsgMenu();\n});\n\n// ============================================================================\n// INIT\n// ============================================================================\n\n// Initialize WebSocket connection\nconnect();\n\n// Pre-load chat history in background (instant render when user opens chat)\nloadHistoryInBackground();\n\n// ============================================================================\n// PREVENT DOUBLE-TAP ZOOM (iOS Safari fix)\n// ============================================================================\n\nlet lastTouchEnd = 0;\ndocument.addEventListener('touchend', (e) => {\n  const now = Date.now();\n  if (now - lastTouchEnd <= 300) {\n    e.preventDefault();\n  }\n  lastTouchEnd = now;\n}, { passive: false });\n\n// ============================================================================\n// PC STATUS INDICATOR\n// ============================================================================\n\nconst pcStatusEl = document.getElementById('pc-status');\n\nasync function checkPcStatus() {\n  try {\n    const response = await fetch('/api/nodes/status');\n    const data = await response.json();\n    \n    if (pcStatusEl) {\n      pcStatusEl.classList.toggle('connected', data.connected);\n      pcStatusEl.title = data.connected \n        ? `${data.nodeName || 'PC'} connected` \n        : 'PC disconnected';\n    }\n  } catch (e) {\n    console.error('PC status check failed:', e);\n    if (pcStatusEl) {\n      pcStatusEl.classList.remove('connected');\n    }\n  }\n}\n\n// Check immediately and then every 30 seconds\ncheckPcStatus();\nlet statusInterval = setInterval(checkPcStatus, 30000);\n\n// Pause PC status polling when page is hidden (save battery)\ndocument.addEventListener('visibilitychange', () => {\n  if (document.hidden) {\n    if (statusInterval) {\n      clearInterval(statusInterval);\n      statusInterval = null;\n    }\n  } else {\n    // Resume when visible\n    if (!statusInterval) {\n      checkPcStatus();\n      statusInterval = setInterval(checkPcStatus, 30000);\n    }\n  }\n});\n\n// Click handler for WoL\nlet fastPoll = null; // Track fast polling interval to prevent stacking\n\npcStatusEl?.addEventListener('click', async () => {\n  // Clear any existing fast poll first to prevent stacking\n  if (fastPoll) {\n    clearInterval(fastPoll);\n    fastPoll = null;\n  }\n  \n  // Only wake if disconnected\n  if (pcStatusEl.classList.contains('connected')) {\n    toast('PC is already connected');\n    return;\n  }\n  \n  toast('Waking PC...');\n  \n  try {\n    const response = await fetch('/api/nodes/wake', { method: 'POST' });\n    const data = await response.json();\n    \n    if (data.success) {\n      toast('Wake signal sent! Waiting for PC...');\n      \n      // Poll more frequently for 2 minutes\n      clearInterval(statusInterval);\n      let attempts = 0;\n      fastPoll = setInterval(async () => {\n        attempts++;\n        await checkPcStatus();\n        \n        if (pcStatusEl.classList.contains('connected')) {\n          toast('PC connected! \u2705');\n          clearInterval(fastPoll);\n          statusInterval = setInterval(checkPcStatus, 30000);\n        } else if (attempts >= 24) { // 2 minutes (24 * 5s)\n          toast('PC did not respond', true);\n          clearInterval(fastPoll);\n          statusInterval = setInterval(checkPcStatus, 30000);\n        }\n      }, 5000);\n    } else {\n      toast('Wake failed: ' + (data.error || 'Unknown error'), true);\n    }\n  } catch (e) {\n    toast('Wake request failed', true);\n    console.error('WoL error:', e);\n  }\n});\n\n// Keyboard detection\nif (window.visualViewport) {\n  let initialHeight = window.visualViewport.height;\n  window.visualViewport.addEventListener('resize', () => {\n    const diff = initialHeight - window.visualViewport.height;\n    document.body.classList.toggle('keyboard-open', diff > 150);\n  });\n}\n\n// Shortcut buttons\ndocument.querySelectorAll('.shortcut').forEach(btn => {\n  btn.addEventListener('click', () => {\n    const msg = btn.dataset.msg;\n    if (msg) send(msg, 'chat');\n  });\n});\n\n// Articulations mode button handler - enters dedicated articulate session\ndocument.getElementById('articulations-btn')?.addEventListener('click', async () => {\n  // Enter articulate mode session\n  await enterMode('articulate');\n  \n  // Update placeholder for articulate context\n  if (textInput) textInput.placeholder = 'Type text to refine...';\n  \n  // Focus input\n  textInput?.focus();\n});\n\n// ============================================================================\n// ACTIVE SUBAGENT SESSION TRACKING\n// ============================================================================\n\n// Track active subagent sessions by mode\nconst activeSubagentSessions = {\n  'spark-dev-mode': null,\n  'spark-research-mode': null,\n  'spark-plan-mode': null,\n  'spark-videogen-mode': null\n};\n\n// Map button IDs to session labels\nconst buttonToSessionLabel = {\n  'devteam-btn': 'spark-dev-mode',\n  'researcher-btn': 'spark-research-mode',\n  'plan-btn': 'spark-plan-mode',\n  'videogen-btn': 'spark-videogen-mode'\n};\n\n// Map mode names to session labels\nconst modeToSessionLabel = {\n  'dev': 'spark-dev-mode',\n  'research': 'spark-research-mode',\n  'plan': 'spark-plan-mode',\n  'videogen': 'spark-videogen-mode'\n};\n\n// Check for active subagent sessions\nasync function checkActiveSubagentSessions() {\n  try {\n    const response = await fetch('/api/active-sessions');\n    const data = await response.json();\n    \n    // Reset all to null\n    activeSubagentSessions['spark-dev-mode'] = null;\n    activeSubagentSessions['spark-research-mode'] = null;\n    activeSubagentSessions['spark-plan-mode'] = null;\n    activeSubagentSessions['spark-videogen-mode'] = null;\n    \n    // Find matching subagent sessions\n    for (const session of (data.sessions || [])) {\n      const label = session.label || '';\n      if (label.includes('dev-mode') || session.key?.includes('dev-mode')) {\n        activeSubagentSessions['spark-dev-mode'] = session;\n      } else if (label.includes('research-mode') || session.key?.includes('research-mode')) {\n        activeSubagentSessions['spark-research-mode'] = session;\n      } else if (label.includes('plan-mode') || session.key?.includes('plan-mode')) {\n        activeSubagentSessions['spark-plan-mode'] = session;\n      } else if (label.includes('videogen-mode') || session.key?.includes('videogen-mode')) {\n        activeSubagentSessions['spark-videogen-mode'] = session;\n      }\n    }\n    \n    // Update button visual states\n    updateSubagentButtonStates();\n  } catch (e) {\n    console.error('Failed to check active sessions:', e);\n  }\n}\n\n// Update button visual states based on active sessions\nfunction updateSubagentButtonStates() {\n  for (const [btnId, label] of Object.entries(buttonToSessionLabel)) {\n    const btn = document.getElementById(btnId);\n    if (btn) {\n      const isActive = activeSubagentSessions[label] !== null;\n      btn.classList.toggle('session-active', isActive);\n      \n      // Update subtitle to show status\n      const subEl = btn.querySelector('.shortcut-sub');\n      if (subEl) {\n        if (isActive) {\n          const originalText = subEl.dataset.originalText || subEl.textContent;\n          subEl.dataset.originalText = originalText;\n          subEl.textContent = '\u25CF Session active';\n        } else if (subEl.dataset.originalText) {\n          subEl.textContent = subEl.dataset.originalText;\n        }\n      }\n    }\n  }\n}\n\n// Get active session for a mode\nfunction getActiveSession(mode) {\n  const label = modeToSessionLabel[mode] || mode;\n  return activeSubagentSessions[label];\n}\n\n// ============================================================================\n// SESSION PAGE - Full-screen mode session interface\n// ============================================================================\n\nconst sessionPage = document.getElementById('session-page');\nconst sessionMessagesEl = document.getElementById('session-messages');\nconst sessionInput = document.getElementById('session-input');\nconst sessionSendBtn = document.getElementById('session-send-btn');\nconst sessionBackBtn = document.getElementById('session-back-btn');\nconst sessionIcon = document.getElementById('session-icon');\nconst sessionTitle = document.getElementById('session-title');\nconst sessionStatus = document.getElementById('session-status');\n\nlet currentSessionMode = null; // 'dev', 'research', 'plan', 'video'\nlet sessionPageProcessing = false;\n\n// Mode configurations for session page\nconst SESSION_MODE_CONFIG = {\n  dev: {\n    name: 'Dev Mode',\n    icon: '\uD83D\uDC68\u200D\uD83D\uDCBB',\n    sessionKey: 'spark-dev-mode',\n    placeholder: 'Describe what you want to build or fix...',\n    emptyTitle: 'Dev Mode',\n    emptyDesc: 'Start a coding session. Describe what you want to build or fix.'\n  },\n  research: {\n    name: 'Research Mode',\n    icon: '\uD83D\uDD2C',\n    sessionKey: 'spark-research-mode',\n    placeholder: 'What would you like to research?',\n    emptyTitle: 'Research Mode',\n    emptyDesc: 'Start a deep research session. Ask about any topic.'\n  },\n  plan: {\n    name: 'Plan Mode',\n    icon: '\uD83D\uDCCB',\n    sessionKey: 'spark-plan-mode',\n    placeholder: 'What do you want to plan?',\n    emptyTitle: 'Plan Mode',\n    emptyDesc: 'Start planning. Describe your project or feature.'\n  },\n  videogen: {\n    name: 'Video Gen',\n    icon: '\uD83C\uDFAC',\n    sessionKey: 'spark-videogen-mode',\n    placeholder: 'Describe the video you want to create...',\n    emptyTitle: 'Video Gen',\n    emptyDesc: 'Generate AI videos. Describe what you want to create.'\n  }\n};\n\n// Show session page for a specific mode\nasync function showSessionPage(mode) {\n  const config = SESSION_MODE_CONFIG[mode];\n  if (!config) {\n    console.error('Unknown session mode:', mode);\n    return;\n  }\n  \n  currentSessionMode = mode;\n  \n  // Update header\n  sessionIcon.textContent = config.icon;\n  sessionTitle.textContent = config.name;\n  sessionInput.placeholder = config.placeholder;\n  \n  // Check if session is active\n  const activeSession = getActiveSession(mode);\n  if (activeSession) {\n    sessionStatus.textContent = '\u25CF Active';\n    sessionStatus.classList.add('active');\n  } else {\n    sessionStatus.textContent = 'Session';\n    sessionStatus.classList.remove('active');\n  }\n  \n  // Clear messages\n  sessionMessagesEl.innerHTML = '';\n  \n  // Show session page\n  sessionPage.classList.add('show');\n  \n  // Load session history\n  await loadSessionHistory(mode, config);\n  \n  // Focus input\n  setTimeout(() => sessionInput.focus(), 100);\n}\n\n// Hide session page\nfunction hideSessionPage() {\n  sessionPage.classList.remove('show');\n  currentSessionMode = null;\n  sessionPageProcessing = false;\n}\n\n// Load session history from API\nasync function loadSessionHistory(mode, config) {\n  try {\n    const res = await fetch(`/api/modes/${mode}/history?limit=50`);\n    const data = await res.json();\n    const messages = data.messages || [];\n    \n    if (messages.length === 0) {\n      // Show empty state\n      sessionMessagesEl.innerHTML = `\n        <div class=\"session-empty-state\">\n          <div class=\"session-empty-icon\">${config.icon}</div>\n          <div class=\"session-empty-title\">${config.emptyTitle}</div>\n          <div class=\"session-empty-desc\">${config.emptyDesc}</div>\n        </div>\n      `;\n    } else {\n      // Render messages\n      for (const msg of messages) {\n        const text = extractSessionMessageText(msg);\n        if (text) {\n          addSessionMessage(msg.role === 'assistant' ? 'bot' : 'user', text);\n        }\n      }\n      // Scroll to bottom\n      sessionMessagesEl.scrollTop = sessionMessagesEl.scrollHeight;\n    }\n  } catch (e) {\n    console.error('Failed to load session history:', e);\n    sessionMessagesEl.innerHTML = `\n      <div class=\"session-empty-state\">\n        <div class=\"session-empty-icon\">${config.icon}</div>\n        <div class=\"session-empty-title\">${config.emptyTitle}</div>\n        <div class=\"session-empty-desc\">${config.emptyDesc}</div>\n      </div>\n    `;\n  }\n}\n\n// Extract text from message content\nfunction extractSessionMessageText(msg) {\n  if (!msg?.content) return null;\n  if (typeof msg.content === 'string') return msg.content;\n  if (Array.isArray(msg.content)) {\n    const textPart = msg.content.find(c => c.type === 'text');\n    return textPart?.text || null;\n  }\n  return null;\n}\n\n// Add message to session page\nfunction addSessionMessage(type, text) {\n  // Remove empty state if present\n  const emptyState = sessionMessagesEl.querySelector('.session-empty-state');\n  if (emptyState) emptyState.remove();\n  \n  const el = document.createElement('div');\n  el.className = `msg ${type}`;\n  \n  if (type === 'bot') {\n    el.innerHTML = formatMessage(text);\n  } else {\n    el.textContent = text;\n  }\n  \n  sessionMessagesEl.appendChild(el);\n  sessionMessagesEl.scrollTop = sessionMessagesEl.scrollHeight;\n  return el;\n}\n\n// Show thinking indicator in session\nfunction showSessionThinking() {\n  // Remove existing thinking\n  removeSessionThinking();\n  \n  const el = document.createElement('div');\n  el.className = 'msg bot thinking';\n  el.id = 'session-thinking-indicator';\n  el.innerHTML = '<div class=\"thinking-dots\"><span></span><span></span><span></span></div>';\n  sessionMessagesEl.appendChild(el);\n  sessionMessagesEl.scrollTop = sessionMessagesEl.scrollHeight;\n}\n\n// Remove thinking indicator from session\nfunction removeSessionThinking() {\n  document.getElementById('session-thinking-indicator')?.remove();\n}\n\n// Send message in session page\nasync function sendSessionMessage() {\n  const text = sessionInput.value.trim();\n  if (!text || sessionPageProcessing) return;\n  \n  sessionInput.value = '';\n  sessionInput.style.height = 'auto';\n  sessionSendBtn.classList.remove('active');\n  \n  sessionPageProcessing = true;\n  \n  // Add user message\n  addSessionMessage('user', text);\n  \n  // Show thinking\n  showSessionThinking();\n  \n  // Send via WebSocket\n  if (ws && ws.readyState === WebSocket.OPEN) {\n    ws.send(JSON.stringify({\n      type: 'mode_message',\n      sparkMode: currentSessionMode,\n      text: text\n    }));\n  } else {\n    removeSessionThinking();\n    addSessionMessage('bot', 'Not connected. Please try again.');\n    sessionPageProcessing = false;\n  }\n}\n\n// Session input handlers\nsessionInput?.addEventListener('input', () => {\n  const hasText = sessionInput.value.trim().length > 0;\n  sessionSendBtn?.classList.toggle('active', hasText);\n  \n  // Auto-resize\n  sessionInput.style.height = 'auto';\n  sessionInput.style.height = Math.min(sessionInput.scrollHeight, 120) + 'px';\n});\n\nsessionInput?.addEventListener('keydown', (e) => {\n  if (e.key === 'Enter' && !e.shiftKey) {\n    e.preventDefault();\n    sendSessionMessage();\n  }\n});\n\nsessionSendBtn?.addEventListener('click', sendSessionMessage);\n\nsessionBackBtn?.addEventListener('click', hideSessionPage);\n\n// Check on load and every 10 seconds\ncheckActiveSubagentSessions();\nlet subagentPollInterval = setInterval(checkActiveSubagentSessions, 10000);\n\n// Pause polling when page is hidden\ndocument.addEventListener('visibilitychange', () => {\n  if (document.hidden) {\n    if (subagentPollInterval) {\n      clearInterval(subagentPollInterval);\n      subagentPollInterval = null;\n    }\n  } else {\n    if (!subagentPollInterval) {\n      checkActiveSubagentSessions();\n      subagentPollInterval = setInterval(checkActiveSubagentSessions, 10000);\n    }\n  }\n});\n\n// ============================================================================\n// BOTTOM SHEET SYSTEM\n// ============================================================================\n\n/**\n * Create and show a bottom sheet modal\n * @param {Object} config - Configuration object\n * @param {string} config.icon - Emoji icon\n * @param {string} config.title - Title text\n * @param {string} config.subtitle - One-line subtitle\n * @param {string} config.placeholder - Input placeholder\n * @param {string} config.submitText - Submit button text\n * @param {Function} config.onSubmit - Callback with input value\n * @param {Object} config.activeSession - Active session object (optional)\n * @param {Function} config.onViewSession - Callback to view active session (optional)\n * @returns {Object} - { close: Function } to programmatically close\n */\nfunction createBottomSheet({ icon, title, subtitle, placeholder, submitText, onSubmit, activeSession, onViewSession }) {\n  // Create overlay\n  const overlay = document.createElement('div');\n  overlay.className = 'bottom-sheet-overlay';\n  \n  // Create sheet\n  const sheet = document.createElement('div');\n  sheet.className = 'bottom-sheet';\n  \n  // Build active session button HTML if session exists\n  const activeSessionHtml = activeSession ? `\n    <button class=\"bottom-sheet-active-session\">\n      <span class=\"active-dot\">\u25CF</span>\n      View Active Session\n    </button>\n  ` : '';\n  \n  sheet.innerHTML = `\n    <div class=\"bottom-sheet-handle\"></div>\n    <div class=\"bottom-sheet-header\">\n      <span class=\"bottom-sheet-icon\">${icon}</span>\n      <div class=\"bottom-sheet-titles\">\n        <h2 class=\"bottom-sheet-title\">${title}</h2>\n        <p class=\"bottom-sheet-subtitle\">${subtitle}</p>\n      </div>\n    </div>\n    ${activeSessionHtml}\n    <textarea class=\"bottom-sheet-input\" placeholder=\"${placeholder}\" rows=\"1\"></textarea>\n    <button class=\"bottom-sheet-submit\">${submitText}</button>\n  `;\n  \n  document.body.appendChild(overlay);\n  document.body.appendChild(sheet);\n  \n  const input = sheet.querySelector('.bottom-sheet-input');\n  const submitBtn = sheet.querySelector('.bottom-sheet-submit');\n  const handle = sheet.querySelector('.bottom-sheet-handle');\n  const activeSessionBtn = sheet.querySelector('.bottom-sheet-active-session');\n  \n  // Close function with animation\n  function close() {\n    sheet.classList.add('closing');\n    sheet.classList.remove('visible');\n    overlay.classList.remove('visible');\n    \n    setTimeout(() => {\n      overlay.remove();\n      sheet.remove();\n    }, 200);\n  }\n  \n  // Animate in after a frame\n  requestAnimationFrame(() => {\n    requestAnimationFrame(() => {\n      overlay.classList.add('visible');\n      sheet.classList.add('visible');\n      input.focus();\n    });\n  });\n  \n  // Close on overlay tap\n  overlay.addEventListener('click', close);\n  \n  // Swipe to dismiss\n  let startY = 0;\n  let currentY = 0;\n  let isDragging = false;\n  \n  function handleTouchStart(e) {\n    // Only start drag from handle or if at top of scroll\n    const target = e.target;\n    if (target === handle || target === sheet && sheet.scrollTop === 0) {\n      startY = e.touches[0].clientY;\n      currentY = startY;\n      isDragging = true;\n      sheet.style.transition = 'none';\n    }\n  }\n  \n  function handleTouchMove(e) {\n    if (!isDragging) return;\n    currentY = e.touches[0].clientY;\n    const deltaY = currentY - startY;\n    \n    // Only allow dragging down\n    if (deltaY > 0) {\n      const isDesktop = window.innerWidth >= 520;\n      if (isDesktop) {\n        sheet.style.transform = `translateX(-50%) translateY(${deltaY}px)`;\n      } else {\n        sheet.style.transform = `translateY(${deltaY}px)`;\n      }\n    }\n  }\n  \n  function handleTouchEnd() {\n    if (!isDragging) return;\n    isDragging = false;\n    sheet.style.transition = '';\n    \n    const deltaY = currentY - startY;\n    \n    // If dragged more than 100px or with velocity, close\n    if (deltaY > 100) {\n      close();\n    } else {\n      // Snap back\n      const isDesktop = window.innerWidth >= 520;\n      if (isDesktop) {\n        sheet.style.transform = 'translateX(-50%) translateY(0)';\n      } else {\n        sheet.style.transform = 'translateY(0)';\n      }\n    }\n  }\n  \n  sheet.addEventListener('touchstart', handleTouchStart, { passive: true });\n  sheet.addEventListener('touchmove', handleTouchMove, { passive: true });\n  sheet.addEventListener('touchend', handleTouchEnd);\n  \n  // ESC to close\n  function handleKeydown(e) {\n    if (e.key === 'Escape') {\n      close();\n      document.removeEventListener('keydown', handleKeydown);\n    }\n  }\n  document.addEventListener('keydown', handleKeydown);\n  \n  // Submit handler\n  function handleSubmit() {\n    const value = input.value.trim();\n    if (!value) {\n      input.classList.add('error');\n      setTimeout(() => input.classList.remove('error'), 300);\n      return;\n    }\n    close();\n    onSubmit(value);\n  }\n  \n  submitBtn.addEventListener('click', handleSubmit);\n  \n  // Handle view active session button click\n  if (activeSessionBtn && onViewSession) {\n    activeSessionBtn.addEventListener('click', () => {\n      close();\n      onViewSession(activeSession);\n    });\n  }\n  \n  // Enter to submit (Cmd/Ctrl+Enter for multi-line)\n  input.addEventListener('keydown', (e) => {\n    if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {\n      e.preventDefault();\n      handleSubmit();\n    }\n  });\n  \n  // Auto-resize input\n  input.addEventListener('input', () => {\n    input.style.height = 'auto';\n    input.style.height = Math.min(input.scrollHeight, 120) + 'px';\n  });\n  \n  return { close };\n}\n\n// View active subagent session - shows messages from that session\nfunction viewActiveSession(session) {\n  if (!session) return;\n  \n  showChatFeedPage();\n  \n  // Show a system message indicating we're viewing a subagent session\n  const systemMsg = document.createElement('div');\n  systemMsg.className = 'msg system';\n  systemMsg.innerHTML = `\n    <strong>Viewing ${session.label || 'subagent'} session</strong><br>\n    <small style=\"opacity: 0.7\">Session key: ${session.key}</small>\n  `;\n  messagesEl.appendChild(systemMsg);\n  \n  // Send a command to get the session's recent activity\n  send(`Show me the recent activity from the ${session.label || 'subagent'} session (key: ${session.key})`, 'chat');\n}\n\n// Dev Mode button - navigate to session page\ndocument.getElementById('devteam-btn')?.addEventListener('click', () => {\n  const activeSession = getActiveSession('spark-dev-mode');\n  createBottomSheet({\n    icon: '\uD83D\uDC68\u200D\uD83D\uDCBB',\n    title: 'Dev Mode',\n    subtitle: activeSession ? '\u25CF Session active' : 'Isolated coding session',\n    placeholder: 'Describe the task or issue to fix...',\n    submitText: 'Start Dev Session',\n    activeSession,\n    onViewSession: viewActiveSession,\n    onSubmit: (text) => send(`/dev ${text}`, 'chat')\n  });\n});\n\n// Research Mode button - popup modal\ndocument.getElementById('researcher-btn')?.addEventListener('click', () => {\n  const activeSession = getActiveSession('spark-research-mode');\n  createBottomSheet({\n    icon: '\uD83D\uDD2C',\n    title: 'Research Mode',\n    subtitle: activeSession ? '\u25CF Session active' : 'Deep dive research',\n    placeholder: 'What topic do you want to research?',\n    submitText: 'Start Research',\n    activeSession,\n    onViewSession: viewActiveSession,\n    onSubmit: (text) => send(`/research ${text}`, 'chat')\n  });\n});\n\n// Plan Mode button - popup modal\ndocument.getElementById('plan-btn')?.addEventListener('click', () => {\n  const activeSession = getActiveSession('spark-plan-mode');\n  createBottomSheet({\n    icon: '\uD83D\uDCCB',\n    title: 'Plan Mode',\n    subtitle: activeSession ? '\u25CF Session active' : 'Create detailed specs',\n    placeholder: 'What do you want to plan?',\n    submitText: 'Start Planning',\n    activeSession,\n    onViewSession: viewActiveSession,\n    onSubmit: (text) => send(`/plan ${text}`, 'chat')\n  });\n});\n\n// Video Gen button - show modal with 3 variants\ndocument.getElementById('videogen-btn')?.addEventListener('click', () => {\n  showVideoGenModal();\n});\n\n/**\n * Video Gen modal - custom bottom sheet with workflow selection\n * Supports: Text to Video, Image to Video, Face Swap\n */\nfunction showVideoGenModal() {\n  // Create overlay\n  const overlay = document.createElement('div');\n  overlay.className = 'bottom-sheet-overlay';\n  \n  // Create sheet\n  const sheet = document.createElement('div');\n  sheet.className = 'bottom-sheet';\n  \n  sheet.innerHTML = `\n    <div class=\"bottom-sheet-handle\"></div>\n    <div class=\"bottom-sheet-header\">\n      <span class=\"bottom-sheet-icon\">\uD83C\uDFAC</span>\n      <div class=\"bottom-sheet-titles\">\n        <h2 class=\"bottom-sheet-title\">Video Gen</h2>\n        <p class=\"bottom-sheet-subtitle\" id=\"videogen-subtitle\">AI video generation</p>\n      </div>\n    </div>\n    \n    <div class=\"bottom-sheet-row\">\n      <label class=\"bottom-sheet-label\">Workflow</label>\n      <div class=\"option-selector\" id=\"videogen-workflow\">\n        <button class=\"option-pill selected\" data-value=\"text2video\">Text \u2192 Video</button>\n        <button class=\"option-pill\" data-value=\"image2video\">Image \u2192 Video</button>\n        <button class=\"option-pill\" data-value=\"faceswap\">Face Swap</button>\n      </div>\n    </div>\n    \n    <div class=\"bottom-sheet-row\" id=\"videogen-prompt-row\">\n      <label class=\"bottom-sheet-label\">Prompt</label>\n      <textarea class=\"bottom-sheet-input\" id=\"videogen-prompt\" placeholder=\"Describe the video you want to create...\" rows=\"2\"></textarea>\n    </div>\n    \n    <div class=\"bottom-sheet-row\" id=\"videogen-image-row\" style=\"display:none;\">\n      <label class=\"bottom-sheet-label\" id=\"videogen-image-label\">Reference Image</label>\n      <div class=\"image-upload-area\" id=\"videogen-upload-area\">\n        <div class=\"upload-icon\">\n          <svg viewBox=\"0 0 24 24\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/><polyline points=\"17 8 12 3 7 8\"/><line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/></svg>\n        </div>\n        <div class=\"upload-text\">Tap to upload image</div>\n        <div class=\"upload-hint\" id=\"videogen-image-hint\">For image-to-video generation</div>\n      </div>\n      <input type=\"file\" id=\"videogen-file-input\" accept=\"image/*\" style=\"display:none\">\n    </div>\n    \n    <div class=\"bottom-sheet-row\" id=\"videogen-video-row\" style=\"display:none;\">\n      <label class=\"bottom-sheet-label\">Target Video</label>\n      <div class=\"image-upload-area\" id=\"videogen-video-upload-area\">\n        <div class=\"upload-icon\">\n          <svg viewBox=\"0 0 24 24\"><polygon points=\"23 7 16 12 23 17 23 7\"/><rect x=\"1\" y=\"5\" width=\"15\" height=\"14\" rx=\"2\" ry=\"2\"/></svg>\n        </div>\n        <div class=\"upload-text\">Tap to upload video or paste URL</div>\n        <div class=\"upload-hint\">YouTube/video URL or upload file</div>\n      </div>\n      <input type=\"file\" id=\"videogen-video-file-input\" accept=\"video/*\" style=\"display:none\">\n      <input type=\"text\" class=\"bottom-sheet-input\" id=\"videogen-video-url\" placeholder=\"Or paste YouTube/video URL...\" style=\"margin-top:8px; display:none;\">\n    </div>\n    \n    <div class=\"bottom-sheet-row\" id=\"videogen-aspect-row\">\n      <label class=\"bottom-sheet-label\">Aspect Ratio</label>\n      <div class=\"option-selector\" id=\"videogen-aspect\">\n        <button class=\"option-pill selected\" data-value=\"16:9\">16:9</button>\n        <button class=\"option-pill\" data-value=\"9:16\">9:16</button>\n        <button class=\"option-pill\" data-value=\"1:1\">1:1</button>\n      </div>\n    </div>\n    \n    <div class=\"bottom-sheet-row\" id=\"videogen-duration-row\">\n      <label class=\"bottom-sheet-label\">Duration</label>\n      <div class=\"option-selector\" id=\"videogen-duration\">\n        <button class=\"option-pill selected\" data-value=\"5\">5 seconds</button>\n        <button class=\"option-pill\" data-value=\"10\">10 seconds</button>\n      </div>\n    </div>\n    \n    <button class=\"bottom-sheet-submit\" id=\"videogen-submit\">Generate Video</button>\n  `;\n  \n  document.body.appendChild(overlay);\n  document.body.appendChild(sheet);\n  \n  const subtitleEl = sheet.querySelector('#videogen-subtitle');\n  const workflowSelector = sheet.querySelector('#videogen-workflow');\n  const promptRow = sheet.querySelector('#videogen-prompt-row');\n  const promptInput = sheet.querySelector('#videogen-prompt');\n  const imageRow = sheet.querySelector('#videogen-image-row');\n  const imageLabel = sheet.querySelector('#videogen-image-label');\n  const imageHint = sheet.querySelector('#videogen-image-hint');\n  const uploadArea = sheet.querySelector('#videogen-upload-area');\n  const fileInput = sheet.querySelector('#videogen-file-input');\n  const videoRow = sheet.querySelector('#videogen-video-row');\n  const videoUploadArea = sheet.querySelector('#videogen-video-upload-area');\n  const videoFileInput = sheet.querySelector('#videogen-video-file-input');\n  const videoUrlInput = sheet.querySelector('#videogen-video-url');\n  const aspectRow = sheet.querySelector('#videogen-aspect-row');\n  const aspectSelector = sheet.querySelector('#videogen-aspect');\n  const durationRow = sheet.querySelector('#videogen-duration-row');\n  const durationSelector = sheet.querySelector('#videogen-duration');\n  const submitBtn = sheet.querySelector('#videogen-submit');\n  const handle = sheet.querySelector('.bottom-sheet-handle');\n  \n  // State\n  let selectedWorkflow = 'text2video';\n  let selectedAspect = '16:9';\n  let selectedDuration = '5';\n  let selectedImage = null;\n  let selectedImageData = null;\n  let selectedVideo = null;\n  let selectedVideoData = null;\n  let selectedVideoUrl = null;\n  \n  // Close function with animation\n  function close() {\n    sheet.classList.add('closing');\n    sheet.classList.remove('visible');\n    overlay.classList.remove('visible');\n    \n    setTimeout(() => {\n      overlay.remove();\n      sheet.remove();\n    }, 200);\n  }\n  \n  // Animate in after a frame\n  requestAnimationFrame(() => {\n    requestAnimationFrame(() => {\n      overlay.classList.add('visible');\n      sheet.classList.add('visible');\n      promptInput.focus();\n    });\n  });\n  \n  // Close on overlay tap\n  overlay.addEventListener('click', close);\n  \n  // Swipe to dismiss\n  let startY = 0;\n  let currentY = 0;\n  let isDragging = false;\n  \n  function handleTouchStart(e) {\n    const target = e.target;\n    if (target === handle || target === sheet && sheet.scrollTop === 0) {\n      startY = e.touches[0].clientY;\n      currentY = startY;\n      isDragging = true;\n      sheet.style.transition = 'none';\n    }\n  }\n  \n  function handleTouchMove(e) {\n    if (!isDragging) return;\n    currentY = e.touches[0].clientY;\n    const deltaY = currentY - startY;\n    \n    if (deltaY > 0) {\n      const isDesktop = window.innerWidth >= 520;\n      if (isDesktop) {\n        sheet.style.transform = `translateX(-50%) translateY(${deltaY}px)`;\n      } else {\n        sheet.style.transform = `translateY(${deltaY}px)`;\n      }\n    }\n  }\n  \n  function handleTouchEnd() {\n    if (!isDragging) return;\n    isDragging = false;\n    sheet.style.transition = '';\n    \n    const deltaY = currentY - startY;\n    \n    if (deltaY > 100) {\n      close();\n    } else {\n      const isDesktop = window.innerWidth >= 520;\n      if (isDesktop) {\n        sheet.style.transform = 'translateX(-50%) translateY(0)';\n      } else {\n        sheet.style.transform = 'translateY(0)';\n      }\n    }\n  }\n  \n  sheet.addEventListener('touchstart', handleTouchStart, { passive: true });\n  sheet.addEventListener('touchmove', handleTouchMove, { passive: true });\n  sheet.addEventListener('touchend', handleTouchEnd);\n  \n  // ESC to close\n  function handleKeydown(e) {\n    if (e.key === 'Escape') {\n      close();\n      document.removeEventListener('keydown', handleKeydown);\n    }\n  }\n  document.addEventListener('keydown', handleKeydown);\n  \n  // Helper function for file size\n  function formatFileSizeLocal(bytes) {\n    if (bytes < 1024) return bytes + ' B';\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n  }\n  \n  // Update UI based on workflow\n  function updateWorkflowUI() {\n    // Reset visibility\n    promptRow.style.display = 'block';\n    imageRow.style.display = 'none';\n    videoRow.style.display = 'none';\n    aspectRow.style.display = 'block';\n    durationRow.style.display = 'block';\n    videoUrlInput.style.display = 'none';\n    \n    switch (selectedWorkflow) {\n      case 'text2video':\n        subtitleEl.textContent = 'Generate video from text prompt';\n        promptInput.placeholder = 'Describe the video you want to create...';\n        submitBtn.textContent = 'Generate Video';\n        break;\n      case 'image2video':\n        subtitleEl.textContent = 'Animate an image into video';\n        promptInput.placeholder = 'Describe the motion/action (optional)...';\n        imageRow.style.display = 'block';\n        imageLabel.textContent = 'Source Image';\n        imageHint.textContent = 'Image to animate';\n        submitBtn.textContent = 'Generate Video';\n        break;\n      case 'faceswap':\n        subtitleEl.textContent = 'Swap face in a video';\n        promptRow.style.display = 'none';\n        imageRow.style.display = 'block';\n        videoRow.style.display = 'block';\n        aspectRow.style.display = 'none';\n        durationRow.style.display = 'none';\n        imageLabel.textContent = 'Face Image';\n        imageHint.textContent = 'Photo with the face to use';\n        videoUrlInput.style.display = 'block';\n        submitBtn.textContent = 'Swap Face';\n        break;\n    }\n  }\n  \n  // Workflow selection\n  workflowSelector.addEventListener('click', (e) => {\n    const pill = e.target.closest('.option-pill');\n    if (!pill) return;\n    \n    workflowSelector.querySelectorAll('.option-pill').forEach(p => p.classList.remove('selected'));\n    pill.classList.add('selected');\n    selectedWorkflow = pill.dataset.value;\n    updateWorkflowUI();\n  });\n  \n  // Aspect ratio selection\n  aspectSelector.addEventListener('click', (e) => {\n    const pill = e.target.closest('.option-pill');\n    if (!pill) return;\n    \n    aspectSelector.querySelectorAll('.option-pill').forEach(p => p.classList.remove('selected'));\n    pill.classList.add('selected');\n    selectedAspect = pill.dataset.value;\n  });\n  \n  // Duration selection\n  durationSelector.addEventListener('click', (e) => {\n    const pill = e.target.closest('.option-pill');\n    if (!pill) return;\n    \n    durationSelector.querySelectorAll('.option-pill').forEach(p => p.classList.remove('selected'));\n    pill.classList.add('selected');\n    selectedDuration = pill.dataset.value;\n  });\n  \n  // Helper to reset image upload area\n  function resetImageUpload() {\n    selectedImage = null;\n    selectedImageData = null;\n    uploadArea.classList.remove('has-image');\n    uploadArea.innerHTML = `\n      <div class=\"upload-icon\">\n        <svg viewBox=\"0 0 24 24\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/><polyline points=\"17 8 12 3 7 8\"/><line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/></svg>\n      </div>\n      <div class=\"upload-text\">Tap to upload image</div>\n      <div class=\"upload-hint\" id=\"videogen-image-hint\">${selectedWorkflow === 'faceswap' ? 'Photo with the face to use' : 'Image to animate'}</div>\n    `;\n    fileInput.value = '';\n  }\n  \n  // Helper to reset video upload area\n  function resetVideoUpload() {\n    selectedVideo = null;\n    selectedVideoData = null;\n    selectedVideoUrl = null;\n    videoUploadArea.classList.remove('has-image');\n    videoUploadArea.innerHTML = `\n      <div class=\"upload-icon\">\n        <svg viewBox=\"0 0 24 24\"><polygon points=\"23 7 16 12 23 17 23 7\"/><rect x=\"1\" y=\"5\" width=\"15\" height=\"14\" rx=\"2\" ry=\"2\"/></svg>\n      </div>\n      <div class=\"upload-text\">Tap to upload video or paste URL</div>\n      <div class=\"upload-hint\">YouTube/video URL or upload file</div>\n    `;\n    videoFileInput.value = '';\n    videoUrlInput.value = '';\n  }\n  \n  // Image upload\n  uploadArea.addEventListener('click', () => {\n    if (!selectedImage) {\n      fileInput.click();\n    }\n  });\n  \n  fileInput.addEventListener('change', async (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    \n    selectedImage = file;\n    \n    // Read as data URL for preview and sending\n    const reader = new FileReader();\n    reader.onload = (ev) => {\n      selectedImageData = ev.target.result;\n      \n      // Update upload area to show preview\n      uploadArea.classList.add('has-image');\n      uploadArea.innerHTML = `\n        <div class=\"image-preview-container\">\n          <img class=\"image-preview-thumb\" src=\"${selectedImageData}\" alt=\"Preview\">\n          <div class=\"image-preview-info\">\n            <div class=\"image-preview-name\">${file.name}</div>\n            <div class=\"image-preview-size\">${formatFileSizeLocal(file.size)}</div>\n          </div>\n          <button class=\"image-remove-btn\" id=\"videogen-remove-image\">\n            <svg viewBox=\"0 0 24 24\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/></svg>\n          </button>\n        </div>\n      `;\n      \n      // Add remove handler\n      sheet.querySelector('#videogen-remove-image')?.addEventListener('click', (ev) => {\n        ev.stopPropagation();\n        resetImageUpload();\n      });\n    };\n    reader.readAsDataURL(file);\n  });\n  \n  // Video upload\n  videoUploadArea.addEventListener('click', () => {\n    if (!selectedVideo && !selectedVideoUrl) {\n      videoFileInput.click();\n    }\n  });\n  \n  videoFileInput.addEventListener('change', async (e) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    \n    selectedVideo = file;\n    selectedVideoUrl = null;\n    \n    // Read as data URL\n    const reader = new FileReader();\n    reader.onload = (ev) => {\n      selectedVideoData = ev.target.result;\n      \n      // Update upload area to show preview\n      videoUploadArea.classList.add('has-image');\n      videoUploadArea.innerHTML = `\n        <div class=\"image-preview-container\">\n          <div class=\"upload-icon\" style=\"width:60px;height:60px;display:flex;align-items:center;justify-content:center;background:var(--msg-bot);border-radius:8px;\">\n            <svg viewBox=\"0 0 24 24\" style=\"width:30px;height:30px;stroke:var(--text-secondary);fill:none;\"><polygon points=\"23 7 16 12 23 17 23 7\"/><rect x=\"1\" y=\"5\" width=\"15\" height=\"14\" rx=\"2\" ry=\"2\"/></svg>\n          </div>\n          <div class=\"image-preview-info\">\n            <div class=\"image-preview-name\">${file.name}</div>\n            <div class=\"image-preview-size\">${formatFileSizeLocal(file.size)}</div>\n          </div>\n          <button class=\"image-remove-btn\" id=\"videogen-remove-video\">\n            <svg viewBox=\"0 0 24 24\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/></svg>\n          </button>\n        </div>\n      `;\n      \n      // Add remove handler\n      sheet.querySelector('#videogen-remove-video')?.addEventListener('click', (ev) => {\n        ev.stopPropagation();\n        resetVideoUpload();\n      });\n    };\n    reader.readAsDataURL(file);\n  });\n  \n  // Video URL input\n  videoUrlInput.addEventListener('input', (e) => {\n    const url = e.target.value.trim();\n    if (url && (url.includes('youtube.com') || url.includes('youtu.be') || url.includes('http'))) {\n      selectedVideoUrl = url;\n      selectedVideo = null;\n      selectedVideoData = null;\n      \n      // Show URL in upload area\n      videoUploadArea.classList.add('has-image');\n      videoUploadArea.innerHTML = `\n        <div class=\"image-preview-container\">\n          <div class=\"upload-icon\" style=\"width:60px;height:60px;display:flex;align-items:center;justify-content:center;background:var(--msg-bot);border-radius:8px;\">\n            <svg viewBox=\"0 0 24 24\" style=\"width:30px;height:30px;stroke:var(--text-secondary);fill:none;\"><polygon points=\"23 7 16 12 23 17 23 7\"/><rect x=\"1\" y=\"5\" width=\"15\" height=\"14\" rx=\"2\" ry=\"2\"/></svg>\n          </div>\n          <div class=\"image-preview-info\">\n            <div class=\"image-preview-name\" style=\"word-break:break-all;\">${url.length > 40 ? url.substring(0, 40) + '...' : url}</div>\n            <div class=\"image-preview-size\">Video URL</div>\n          </div>\n          <button class=\"image-remove-btn\" id=\"videogen-remove-video\">\n            <svg viewBox=\"0 0 24 24\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/></svg>\n          </button>\n        </div>\n      `;\n      \n      sheet.querySelector('#videogen-remove-video')?.addEventListener('click', (ev) => {\n        ev.stopPropagation();\n        resetVideoUpload();\n      });\n    }\n  });\n  \n  // Submit handler\n  submitBtn.addEventListener('click', () => {\n    const prompt = promptInput.value.trim();\n    \n    // Validate based on workflow\n    if (selectedWorkflow === 'text2video') {\n      if (!prompt) {\n        promptInput.classList.add('error');\n        setTimeout(() => promptInput.classList.remove('error'), 300);\n        return;\n      }\n    } else if (selectedWorkflow === 'image2video') {\n      if (!selectedImageData) {\n        uploadArea.style.borderColor = 'var(--red)';\n        setTimeout(() => uploadArea.style.borderColor = '', 300);\n        return;\n      }\n    } else if (selectedWorkflow === 'faceswap') {\n      if (!selectedImageData) {\n        uploadArea.style.borderColor = 'var(--red)';\n        setTimeout(() => uploadArea.style.borderColor = '', 300);\n        return;\n      }\n      if (!selectedVideoData && !selectedVideoUrl) {\n        videoUploadArea.style.borderColor = 'var(--red)';\n        setTimeout(() => videoUploadArea.style.borderColor = '', 300);\n        return;\n      }\n    }\n    \n    close();\n    showChatFeedPage();\n    \n    // Build and send command based on workflow\n    if (selectedWorkflow === 'text2video') {\n      let command = `/video --ratio ${selectedAspect} --duration ${selectedDuration}s ${prompt}`;\n      send(command, 'chat');\n    } else if (selectedWorkflow === 'image2video') {\n      let command = `/video --ratio ${selectedAspect} --duration ${selectedDuration}s`;\n      if (prompt) command += ` ${prompt}`;\n      sendVideoGenWithImage(command, selectedImageData);\n    } else if (selectedWorkflow === 'faceswap') {\n      // Build face swap command\n      let command = `/faceswap`;\n      if (selectedVideoUrl) {\n        command += ` --video-url ${selectedVideoUrl}`;\n      }\n      // Send with image (and optionally video data)\n      sendFaceSwapRequest(command, selectedImageData, selectedVideoData, selectedVideoUrl);\n    }\n  });\n  \n  // Auto-resize prompt input\n  promptInput.addEventListener('input', () => {\n    promptInput.style.height = 'auto';\n    promptInput.style.height = Math.min(promptInput.scrollHeight, 120) + 'px';\n  });\n}\n\n// Send video gen command with image attachment\nfunction sendVideoGenWithImage(command, imageData) {\n  if (!ws || ws.readyState !== WebSocket.OPEN) {\n    toast('Not connected', true);\n    return;\n  }\n  isProcessing = true;\n  updateSparkPillText();\n  \n  // Show user message with image indicator\n  const el = document.createElement('div');\n  el.className = 'msg user';\n  el.textContent = command + ' \uD83D\uDCF7';\n  messagesEl.appendChild(el);\n  messagesEl.scrollTop = messagesEl.scrollHeight;\n  \n  trackDisplayedMessage(command);\n  showThinking();\n  \n  ws.send(JSON.stringify({ type: 'transcript', text: command, image: imageData, mode: 'chat', model: currentModel }));\n}\n\n// Send face swap request with image and video\nfunction sendFaceSwapRequest(command, imageData, videoData, videoUrl) {\n  if (!ws || ws.readyState !== WebSocket.OPEN) {\n    toast('Not connected', true);\n    return;\n  }\n  isProcessing = true;\n  updateSparkPillText();\n  \n  // Show user message\n  const el = document.createElement('div');\n  el.className = 'msg user';\n  el.textContent = command + ' \uD83C\uDFAD\uD83D\uDCF7\uD83C\uDFAC';\n  messagesEl.appendChild(el);\n  messagesEl.scrollTop = messagesEl.scrollHeight;\n  \n  trackDisplayedMessage(command);\n  showThinking();\n  \n  // Send with both image and video data/url\n  ws.send(JSON.stringify({ \n    type: 'transcript', \n    text: command, \n    image: imageData, \n    video: videoData,\n    videoUrl: videoUrl,\n    mode: 'chat',\n    model: currentModel \n  }));\n}\n\n// Override send for articulations mode\nconst originalSend = send;\nsend = async function(text, sendMode) {\n  if (articulationsMode) {\n    await sendArticulation(text);\n  } else {\n    await originalSend(text, sendMode);\n  }\n};\n\nasync function sendArticulation(text) {\n  if (!text.trim()) return;\n  \n  // Ensure we're in chat feed mode\n  if (pageState === 'intro') {\n    showChatFeedPage({ skipHistory: true });\n  }\n  \n  // Show user message\n  const userEl = document.createElement('div');\n  userEl.className = 'msg user';\n  userEl.textContent = text;\n  messagesEl.appendChild(userEl);\n  messagesEl.scrollTop = messagesEl.scrollHeight;\n  \n  // Show thinking\n  showThinking();\n  \n  try {\n    const response = await fetch('/api/articulate', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ text })\n    });\n    \n    const data = await response.json();\n    removeThinking();\n    \n    if (data.result) {\n      const botEl = document.createElement('div');\n      botEl.className = 'msg bot';\n      botEl.textContent = data.result;\n      messagesEl.appendChild(botEl);\n      messagesEl.scrollTop = messagesEl.scrollHeight;\n    }\n  } catch (e) {\n    removeThinking();\n    toast('Failed to refine text', true);\n  }\n}\n\n// NOTE: Articulations mode reset is now handled directly in showIntroPage()\n// (removed monkey-patch pattern for cleaner code and to prevent state issues)\n\n// Today's Reports button - enters daily reports mode session\ndocument.getElementById('todays-reports-btn')?.addEventListener('click', async () => {\n  // Enter daily reports mode session\n  await enterMode('dailyreports');\n  \n  // Show today's reports as initial content\n  const loadingEl = document.createElement('div');\n  loadingEl.className = 'msg system';\n  loadingEl.textContent = 'Loading today\\'s reports...';\n  messagesEl.appendChild(loadingEl);\n  \n  try {\n    const response = await fetch('/api/reports/today');\n    const data = await response.json();\n    \n    loadingEl.remove();\n    \n    if (!data.reports?.length) {\n      // If no reports, suggest generating one\n      send('Show me today\\'s reports or generate a new briefing if none exist.', 'chat');\n      return;\n    }\n    \n    // Show header\n    const headerEl = document.createElement('div');\n    headerEl.className = 'msg system';\n    headerEl.textContent = `\uD83D\uDCCA Today's Reports (${data.reports.length})`;\n    messagesEl.appendChild(headerEl);\n    \n    // Display each report as a bot message\n    data.reports.forEach(r => {\n      const el = document.createElement('div');\n      el.className = 'msg bot';\n      el.innerHTML = formatMessage(r.summary);\n      messagesEl.appendChild(el);\n    });\n    \n    messagesEl.scrollTop = messagesEl.scrollHeight;\n    \n  } catch (e) {\n    loadingEl.textContent = 'Failed to load reports';\n    console.error('Failed to load reports:', e);\n  }\n});\n\n// File upload with preview\nconst attachmentPreview = document.getElementById('attachment-preview');\nconst attachmentIcon = document.getElementById('attachment-icon');\nconst attachmentName = document.getElementById('attachment-name');\nconst attachmentSize = document.getElementById('attachment-size');\nconst removeAttachmentBtn = document.getElementById('remove-attachment-btn');\n\nlet pendingAttachment = null;\n\nuploadBtn?.addEventListener('click', () => fileInput?.click());\n\nfileInput?.addEventListener('change', (e) => {\n  const file = e.target.files?.[0];\n  if (!file) return;\n  \n  // Store the file\n  pendingAttachment = file;\n  \n  // Update preview\n  attachmentName.textContent = file.name;\n  attachmentSize.textContent = formatFileSize(file.size);\n  \n  // Update icon based on type\n  if (file.type.startsWith('image/')) {\n    attachmentIcon.classList.add('image');\n    attachmentIcon.innerHTML = `<svg viewBox=\"0 0 24 24\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/><circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"/><path d=\"M21 15l-5-5L5 21\"/></svg>`;\n  } else {\n    attachmentIcon.classList.remove('image');\n    attachmentIcon.innerHTML = `<svg viewBox=\"0 0 24 24\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"/><path d=\"M14 2v6h6\"/></svg>`;\n  }\n  \n  // Show preview\n  attachmentPreview?.classList.add('show');\n  \n  // Show send button, hide voice button\n  sendBtn?.classList.add('show');\n  voiceBtn?.classList.add('hidden');\n  \n  // Focus text input\n  textInput?.focus();\n  \n  fileInput.value = '';\n});\n\nremoveAttachmentBtn?.addEventListener('click', () => {\n  pendingAttachment = null;\n  attachmentPreview?.classList.remove('show');\n  if (!textInput?.value.trim()) {\n    sendBtn?.classList.remove('show');\n    voiceBtn?.classList.remove('hidden');\n  }\n});\n\nfunction formatFileSize(bytes) {\n  if (bytes < 1024) return bytes + ' B';\n  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n}\n\n// Override submitText to handle attachments\nconst originalSubmitText = submitText;\nsubmitText = async function() {\n  const text = textInput?.value.trim() || '';\n  \n  if (!text && !pendingAttachment) return;\n  if (isProcessing) return;\n  \n  let messageText = text;\n  let imageData = null;\n  \n  // Handle attachment\n  if (pendingAttachment) {\n    const file = pendingAttachment;\n    try {\n      if (file.type.startsWith('image/')) {\n        // Read image as base64\n        imageData = await new Promise((res, rej) => {\n          const r = new FileReader();\n          r.onload = () => res(r.result); // This is a data URL\n          r.onerror = rej;\n          r.readAsDataURL(file);\n        });\n        messageText = text || 'What is this image?';\n      } else {\n        const content = await new Promise((res, rej) => {\n          const r = new FileReader();\n          r.onload = () => res(r.result);\n          r.onerror = rej;\n          r.readAsText(file);\n        });\n        const preview = content.slice(0, 2000) + (content.length > 2000 ? '...' : '');\n        messageText = text ? `${text}\\n\\n[File: ${file.name}]\\n${preview}` : `[File: ${file.name}]\\n${preview}`;\n      }\n    } catch {\n      toast('Failed to read file', true);\n      return;\n    }\n    \n    // Clear attachment\n    pendingAttachment = null;\n    attachmentPreview?.classList.remove('show');\n  }\n  \n  if (!messageText) return;\n  \n  textInput.value = '';\n  textInput.style.height = 'auto';\n  sendBtn?.classList.remove('show');\n  voiceBtn?.classList.remove('hidden');\n  \n  // Send with image if present\n  if (imageData) {\n    sendWithImage(messageText, imageData);\n  } else {\n    send(messageText, 'chat');\n  }\n};\n\n// Send message with image attachment\nfunction sendWithImage(text, imageData) {\n  if (!ws || ws.readyState !== WebSocket.OPEN) {\n    toast('Not connected', true);\n    return;\n  }\n  isProcessing = true;\n  \n  // Show user message with image indicator\n  const userMsg = addMsg(text + ' \uD83D\uDCF7', 'user', { userInitiated: true });\n  showThinking();\n  \n  ws.send(JSON.stringify({ type: 'transcript', text, image: imageData, mode: 'chat', model: currentModel }));\n}\n"],
  "mappings": "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",
  "names": ["mode", "voiceBar", "mode", "submitText", "handle", "fileInput", "ev"]
}
