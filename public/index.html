<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Spark v90</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">
  <!-- Prevent theme flash: apply saved theme before CSS renders -->
  <script>
    (function() {
      var saved = localStorage.getItem('theme');
      if (saved) {
        document.documentElement.setAttribute('data-theme', saved);
      }
    })();
  </script>
  <!-- Preconnect to speed up WebSocket -->
  <link rel="preconnect" href="/">
  <link rel="dns-prefetch" href="/">
  <link rel="stylesheet" href="styles/main.min.css?v=131">
</head>
<body>
  <!-- PC Status Pill -->
  <div id="status-pills">
    <div id="spark-status" class="status-pill connecting" title="Clawdbot Gateway">
      <span class="status-dot"></span>
      <svg class="status-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M13 3L4 14h7v7l9-11h-7V3z"/></svg>
    </div>
    <div id="pc-status" class="status-pill" title="PC Status">
      <span class="status-dot"></span>
      <svg class="status-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h16c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2h-5v2h2v2H7v-2h2v-2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2zm0 2v10h16V6H4z"/></svg>
    </div>
  </div>

  <!-- Theme toggle button -->
  <button id="theme-btn" title="Toggle theme" aria-label="Toggle dark mode">
    <svg class="sun" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="5"/>
      <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
      <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
    </svg>
    <svg class="moon" viewBox="0 0 24 24">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
    </svg>
  </button>

  <!-- History button -->
  <button id="history-btn" title="Chat History" aria-label="View conversation history">
    <svg viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10"/>
      <polyline points="12 6 12 12 16 14"/>
    </svg>
  </button>

  <!-- History panel -->
  <div id="history-panel">
    <div class="header">
      <button class="back-btn" id="history-back-btn" aria-label="Close history panel">
        <svg viewBox="0 0 24 24">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </button>
      <h2>Chat History</h2>
    </div>
    <div class="sessions" id="sessions-list">
      <div style="text-align: center; padding: 40px; color: var(--text-tertiary);">
        Loading...
      </div>
    </div>
  </div>

  <div id="bg"></div>

  <div id="app">
    <!-- Chat mode content -->
    <div id="messages">
      <div id="welcome">
        <div id="greeting">
          <h1>Hi, Parth,<br>how can I help?</h1>
        </div>
        <div id="shortcuts">
          <!-- MODES Section -->
          <div class="shortcut-section">
            <div class="shortcut-section-header">Modes</div>
            <div class="shortcut-section-items">
              <button class="shortcut" id="devteam-btn" aria-label="Start dev mode">
                <svg class="shortcut-icon" viewBox="0 0 24 24"><path d="M16 18l6-6-6-6"/><path d="M8 6l-6 6 6 6"/></svg>
                <div class="shortcut-content">
                  <span class="shortcut-title">Dev Mode</span>
                  <span class="shortcut-sub">Coding sessions</span>
                </div>
              </button>
              <button class="shortcut" id="researcher-btn" aria-label="Start research mode">
                <svg class="shortcut-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                <div class="shortcut-content">
                  <span class="shortcut-title">Research Mode</span>
                  <span class="shortcut-sub">Deep dive research</span>
                </div>
              </button>
              <button class="shortcut" id="plan-btn" aria-label="Start plan mode">
                <svg class="shortcut-icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
                <div class="shortcut-content">
                  <span class="shortcut-title">Plan Mode</span>
                  <span class="shortcut-sub">Detailed specs</span>
                </div>
              </button>
              <button class="shortcut" id="todays-reports-btn" aria-label="View daily reports">
                <svg class="shortcut-icon" viewBox="0 0 24 24"><path d="M3 3v18h18"/><path d="M18 9l-5 5-4-4-3 3"/></svg>
                <div class="shortcut-content">
                  <span class="shortcut-title">Daily Reports</span>
                  <span class="shortcut-sub">Portfolio updates</span>
                </div>
              </button>
            </div>
          </div>

          <!-- CREATE Section -->
          <div class="shortcut-section">
            <div class="shortcut-section-header">Create</div>
            <div class="shortcut-section-items">
              <button class="shortcut" id="videogen-btn" aria-label="Generate video">
                <svg class="shortcut-icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/><line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/><line x1="17" y1="7" x2="22" y2="7"/></svg>
                <div class="shortcut-content">
                  <span class="shortcut-title">Video Gen</span>
                  <span class="shortcut-sub">Text/image to video</span>
                </div>
              </button>
              <button class="shortcut" id="articulations-btn" aria-label="View articulations">
                <svg class="shortcut-icon" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                <div class="shortcut-content">
                  <span class="shortcut-title">Articulate</span>
                  <span class="shortcut-sub">Refine text</span>
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Voice mode content - scrolling transcript log -->
    <div id="voice-content">
      <!-- Messages will be appended here dynamically -->
    </div>

    <!-- Notes mode content -->
    <div id="notes-content">
      <!-- Recording view -->
      <div id="notes-recording">
        <div class="timer" id="notes-timer">0:00</div>
        <div class="waveform">
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
        </div>
        <div class="status">Recording...</div>
      </div>
      <!-- Results view (chat-style) -->
      <div id="notes-results">
        <div id="notes-messages">
          <!-- Status shown during processing -->
          <div id="notes-status" class="notes-status">Transcribing...</div>
          <!-- Transcription as plain chat message -->
          <div class="msg bot" id="notes-transcription-msg" style="display:none;">
            <div id="notes-transcription"></div>
          </div>
          <!-- Summary as plain chat message -->
          <div class="msg bot" id="notes-summary-msg" style="display:none;">
            <div id="notes-summary"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="status"></div>
    <div id="timer">0:00</div>

    <button id="clear-chat-btn" aria-label="Clear chat">Clear chat</button>
    <button id="close-btn" aria-label="Close">Close</button>

    <div id="bottom">
      <!-- Voice button - circle -->
      <button id="voice-btn" class="circle-btn" title="Voice" aria-label="Start voice conversation">
        <svg viewBox="0 0 24 24">
          <path d="M12 1a4 4 0 0 1 4 4v6a4 4 0 0 1-8 0V5a4 4 0 0 1 4-4z"/>
          <path d="M19 10v1a7 7 0 0 1-14 0v-1"/>
          <line x1="12" y1="19" x2="12" y2="23"/>
        </svg>
      </button>

      <!-- Center input bar -->
      <div id="input-bar">
        <button id="upload-btn" title="Attach file" aria-label="Attach file">
          <svg viewBox="0 0 24 24">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
        </button>
        <input type="file" id="file-input" multiple accept="image/*,.pdf,.txt,.md,.json,.csv">
        <!-- Attachment preview -->
        <div id="attachment-preview" class="attachment-preview">
          <div id="attachment-icon" class="attachment-icon">
            <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>
          </div>
          <div class="attachment-info">
            <span id="attachment-name" class="attachment-name"></span>
            <span id="attachment-size" class="attachment-size"></span>
          </div>
          <button id="remove-attachment-btn" class="remove-attachment-btn" aria-label="Remove attachment">
            <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <textarea id="text-input" placeholder="Talk to me" rows="1" aria-label="Message input"></textarea>
        <button id="send-btn" aria-label="Send message">
          <svg viewBox="0 0 24 24">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>

      <!-- Voice mode bar (shown when voice active) -->
      <div id="voice-bar">
        <div class="mic-icon">
          <svg viewBox="0 0 24 24">
            <path d="M12 1a4 4 0 0 1 4 4v6a4 4 0 0 1-8 0V5a4 4 0 0 1 4-4z"/>
            <path d="M19 10v1a7 7 0 0 1-14 0v-1"/>
            <line x1="12" y1="19" x2="12" y2="23"/>
          </svg>
        </div>
        <div id="waveform">
          <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        </div>
        <span class="listening-indicator" id="voice-status">Listening</span>
      </div>

      <!-- Close voice button - separate circle -->
      <button id="close-voice-btn" title="Close" aria-label="Close voice conversation">
        <svg viewBox="0 0 24 24">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>

      <!-- Notes mode: Recording buttons -->
      <button id="close-notes-btn" class="circle-btn" title="Stop Recording" aria-label="Stop and transcribe">
        <svg viewBox="0 0 24 24">
          <rect x="6" y="6" width="12" height="12" rx="2"/>
        </svg>
      </button>

      <button id="delete-notes-btn" class="circle-btn" title="Discard" aria-label="Discard recording">
        <svg viewBox="0 0 24 24">
          <polyline points="3 6 5 6 21 6"/>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        </svg>
      </button>

      <!-- Notes mode: Results action buttons (Save, Delete, Back) -->
      <button id="notes-save-btn" class="circle-btn" title="Save Note" aria-label="Save note">
        <svg viewBox="0 0 24 24">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
          <polyline points="17 21 17 13 7 13 7 21"/>
          <polyline points="7 3 7 8 15 8"/>
        </svg>
      </button>

      <button id="notes-delete-btn" class="circle-btn" title="Delete Note" aria-label="Delete this note">
        <svg viewBox="0 0 24 24">
          <polyline points="3 6 5 6 21 6"/>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        </svg>
      </button>

      <button id="notes-back-btn" class="circle-btn" title="Back" aria-label="Back to intro">
        <svg viewBox="0 0 24 24">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>

      <!-- Notes mode bar -->
      <div id="notes-bar">
        <div class="waveform-mini">
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
        </div>
        <div class="note-icon">
          <svg viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <path d="M14 2v6h6"/>
            <path d="M16 13H8"/>
            <path d="M16 17H8"/>
          </svg>
        </div>
      </div>

      <!-- Notes button - circle -->
      <button id="notes-btn" class="circle-btn" title="Voice Note" aria-label="Record voice note">
        <svg viewBox="0 0 24 24">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <path d="M14 2v6h6"/>
          <path d="M16 13H8"/>
          <path d="M16 17H8"/>
        </svg>
      </button>
      
      <!-- Close chat button - shown in chatfeed mode -->
      <button id="close-chat-btn" class="circle-btn" aria-label="Close chat">
        <svg viewBox="0 0 24 24">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Session Page (full-screen overlay for mode sessions) -->
  <div id="session-page" class="session-page">
    <div class="session-header">
      <button id="session-back-btn" class="session-back-btn" aria-label="Go back">
        <svg viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
      </button>
      <span id="session-header-title" class="session-header-title"></span>
      <!-- Connection status indicator -->
      <div id="session-status-indicator" class="session-status-indicator" title="Connection status">
        <span class="session-status-dot"></span>
      </div>
      <div style="flex:1"></div>
      <button id="session-history-btn" class="session-history-btn" title="Session history">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
      </button>
      <button id="session-new-btn" class="session-new-btn" title="New session" aria-label="New session">
        <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
      </button>
    </div>
    <div id="session-messages" class="session-messages"></div>
    <div class="session-input-bar">
      <div class="session-input-pill">
        <button id="session-upload-btn" class="session-upload-btn" title="Attach file" aria-label="Attach file">
          <svg viewBox="0 0 24 24">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
        </button>
        <input type="file" id="session-file-input" accept="image/*,.pdf,.txt,.md,.json,.csv">
        <!-- Session attachment preview -->
        <div id="session-attachment-preview" class="attachment-preview">
          <div id="session-attachment-icon" class="attachment-icon">
            <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg>
          </div>
          <div class="attachment-info">
            <span id="session-attachment-name" class="attachment-name"></span>
            <span id="session-attachment-size" class="attachment-size"></span>
          </div>
          <button id="session-remove-attachment-btn" class="remove-attachment-btn" aria-label="Remove attachment">
            <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <textarea id="session-input" class="session-input" placeholder="Type a message..." rows="1"></textarea>
        <button id="session-send-btn" class="session-send-btn" aria-label="Send">
          <svg viewBox="0 0 24 24">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Session history slide-out panel -->
  <div id="session-history-panel" class="session-history-panel">
    <div class="session-history-header">
      <span class="session-history-title">Sessions</span>
      <button id="session-history-close" class="session-history-close" aria-label="Close">
        <svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
      </button>
    </div>
    <div id="session-history-list" class="session-history-list"></div>
  </div>

  <div id="toast"></div>

  <!-- Message context menu -->
  <div id="msg-menu">
    <button class="menu-btn" id="menu-copy" title="Copy" aria-label="Copy message">
      <svg viewBox="0 0 24 24">
        <rect x="9" y="9" width="13" height="13" rx="2"/>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
      </svg>
    </button>
    <button class="menu-btn" id="menu-edit" title="Edit" aria-label="Edit message">
      <svg viewBox="0 0 24 24">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
      </svg>
    </button>
    <button class="menu-btn delete" id="menu-delete" title="Delete" aria-label="Delete message">
      <svg viewBox="0 0 24 24">
        <polyline points="3 6 5 6 21 6"/>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
      </svg>
    </button>
  </div>
  <script type="module" src="app.bundle.js?v=131"></script>
</body>
</html>
